(непубличный документ)

Документация по API «Нью-Тел»

Версия этого документа: непубличный документ (БЕТА-версия от 03.05.21).
# История изменений документа
03.05.21 – переписан раздел «Аутентификации и авторизация»
# Аннотация
Данный документ описывает возможности взаимодействия с API «Нью-Тел», доступные всем зарегистрированным абонентам, у которых подключена услуга «Интеграция + API/Webhooks».

Мое предположение

Мое предположение
# Описание протокола
1. Запросы к API «Нью-Тел» осуществляются посредством протокола HTTPS на адрес: https://api.new-tel.net/.

Мое предположение, надо уточнить

Мое предположение, надо уточнить.

1. Клиентская сторона должна проверять корректность SSL-сертификата сервера, и, если SSL-сертификат не прошёл проверку, следует немедленно прекратить сессию во избежание утечки данных.
1. Ключи для взаимодействия с API не должны храниться в открытом виде, например, в cookie.

Примечание: в данной документации все примеры ответов API-сервера отформатированы с добавлением пробелов и переводов строк для лучшей читаемости.
## Аутентификация и авторизация
Для авторизации запросов используется схема на основе Bearer токена, при этом интеграция не подразумевает полноценную реализацию протокола oAuth 2.0 с выдачей access и refresh токенов. Достаточно в каждый запрос добавить Bearer токен в формате:

Authorization: Bearer token

Токен формируется для каждого запроса динамически и представляет собой строку длиной 112 символа, полученной путем конкатенации:

1. Постоянного «Ключа доступа к API-серверу».
1. Динамической метки времени.
1. Динамической подписи запроса в виде хэша по алгоритму SHA-256 от нескольких переменных путем их конкатенации.

См. пример формирования токена на PHP:

$token = $keyNewtel.$time.hash ("sha256", $methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey)

где:

1. \n - команда переноса строки, является разделителем переменных.
1. $methodName - относительный путь для вызова метода, например: company/get-state.
1. $time - метка времени запроса, формируется динамически клиентом при создании запроса и передаётся в виде Unix timestamp. Представляет собой строку, состоящую из 10-и десятичных цифр. **Для прохождения аутентификации и авторизации все запросы должны иметь метку времени в пределах ±10 минут от текущего мирового времени.**
1. $keyNewtel - постоянный «Ключ доступа к API-серверу», который представляет собой строку из 48-и шестнадцатеричных цифр в нижнем регистре (десятичных цифр и латинских букв «a», «b», «c», «d», «e» и «f»). Ключ доступа имеет неограниченный срок жизни и формируется клиентом самостоятельно в личном кабинете «Нью-Тел».
1. $params - тело запроса (BODY) со всеми значениями в application/json или application/x-www-form-urlencoded формате.
1. $writeKey - постоянный «Ключ для подписи запросов», который представляет собой строку из 48-и шестнадцатеричных цифр в нижнем регистре (десятичных цифр и латинских букв «a», «b», «c», «d», «e» и «f»). Ключ доступа имеет неограниченный срок жизни и формируется клиентом самостоятельно в личном кабинете «Нью-Тел».

Пример успешного запроса к серверу приведен ниже. 

<?php

$dataArr = '';

$data = json\_encode($dataArr);

var\_dump($data);

$time = time();

$resId = curl\_init();

$token = getToken('company/get-state',

`   `$time,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

`   `$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl\_setopt\_array($resId, [

`    `CURLINFO\_HEADER\_OUT => true,

`    `CURLOPT\_HEADER => 0,

`    `CURLOPT\_HTTPHEADER => [

`        `'Authorization: Bearer '.$key ,

`        `'Content-Type: application/json' ,

`    `],

`    `CURLOPT\_POST => true,

`    `CURLOPT\_RETURNTRANSFER => true,

`    `CURLOPT\_SSL\_VERIFYPEER => false,

`    `CURLOPT\_URL => 'https://api.new-tel.net/company/get-state',

`    `CURLOPT\_POSTFIELDS => $data,

`    `]);

`    `$response = curl\_exec($resId);

`    `$curlInfo = curl\_getinfo($resId);



`    `var\_dump($response);                                                                                                                                                                                                                                                                                                                    

function getToken ($methodName , $time , $keyNewtel  , $params , $writeKey  ) {

return $keyNewtel.$time.hash( 'sha256' , $methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

}
## Формат запроса
Для всех запросов используется только метод POST, следуя спецификации HTTP/1.1.

Клиент сам может выбрать для любого запроса формат?

Клиент сам может выбрать для любого запроса формат? application/json или application/x-www-form-urlencoded.

Строка параметров запроса должна быть сформирована в кодировке UTF-8 без дополнительных пробелов и переносов строк. Например, в PHP это можно сделать методами: json\_encode($params) или http\_build\_query($params), где: $params – ассоциативный массив параметров или объект.

Формат данных запроса должен быть указан в заголовке: Content-Type.

По факту не видно, что бы использовался, реально надо передавать?

По факту не видно, что бы использовался, реально надо передавать?

Пример запроса для получения информации о состоянии компании-абонента:

URI

https://api.new-tel.net/company/get-state

HEAD

Authorization: Bearer df9b7fg89n79...

Content-Type: application/json

BODY

{}
## Лимиты на запросы
????????????
## Формат ответа
Ответные данные возвращаются всегда в кодировке UTF-8. Формат данных может быть указан в заголовке запроса Accept, где допускаются следующие значения:

1. application/json – для ответа в формате JSON;
1. application/xml – для ответа в формате XML.

В случае отсутствия в запросе заголовка Accept данные возвращаются в формате JSON.

Ответы всех запросов содержат HTTP-заголовок: Signature, в котором передается подпись ответа, способы применения заголовка см. в разделе [Подпись ответа](#_g7ekdhif6jrb).

Тело ответа может содержать следующие атрибуты:

А если сервер вернул 500 ошибку? тоже будет такой формат ответа?

А если сервер вернул 500 ошибку? тоже будет такой формат ответа? от результатов обработки запроса сервером. Информирует о результате обработки запроса API-сервером. Может принимать одно из значений:

1. "success" – обработка запроса прошла успешно (аутентификация и авторизация произведены,  запрашиваемый метод существует, все необходимые параметры присутствуют и валидны);
1. "error" – при обработке запроса произошла ошибка.
1. message - возвращается для запросов при обработке которых произошла ошибка (status = "error"). Содержит текстовое описание ошибки.
1. data - возвращается для успешно обработанных запросов (status = "success"). Содержит дополнительные атрибуты информирующие о результатах выполнения запроса:
   1. result - возвращается всегда, информирует о результатах работы запрашиваемого метода. Может принимать одно из значений:
      1. "success" – запрашиваемый метод успешно выполнен;
      1. "error" – при выполнении метода возникла ошибка.
   1. result - возвращается для запросов при выполнении которых произошла ошибка (status = "error"). Содержит текстовое описание ошибки. Возможные ситуации возникновения ошибки и соответствующие сообщения перечислены в описании методов.
   1. data - возвращается, если запрашиваемый метод подразумевает возврат данных и запрос успешно выполнен (result = "success"). Содержит указанное в описании метода свойство, массив или объект, где будут находиться ответные данные.

Пример ответа для запроса в процессе обработки которого возникла ошибка (например, вызванного метода не существует):

STATUS: 404 Not Found

HEAD

Signature: b8fg980...

BODY

{

`    `"status": "error",

`    `"message": "Requested method not found"

}

Пример ответа для запроса в процессе обработки которого не возникло ошибки, но выполнить запрос сервер не смог (например, невалидное значение в одном из атрибутов запроса):

STATUS: 200 OK

HEAD

Signature: b8fg980...

BODY

{

`    `"status": "success",

`    `"data": {

`        `"result": "error",

`        `"message": "Error occured"

`    `}

}

Пример ответа для успешно обработанного и выполненного (например, при корректном запросе, отправленном на адрес: https://api.new-tel.net/company/get-state):

STATUS: 200 OK

HEAD

Signature: b8fg980...

BODY

{

`     `"status":"success",

`     `"data":{

`          `"result":"success",

`          `"state":{

`               `"balance":97.93,

`               `"credit":0,

`               `"currency":"RUB",

`               `"dayTrafficCost":0,

`               `"monthTrafficCost":0,

`               `"status":"active"

`           `}

`      `}

}
## Поддерживаемый список кодов состояния HTTP
????????????????????
## Подпись ответа
Клиентская сторона может проверять достоверность получаемых данных, сверяя подпись ответа. Подпись ответа вычисляется по алгоритму, аналогичному для вычисления подписи запроса, где вместо строки параметров запроса используется текстовый контент ответного HTTP-сообщения. Результат вычисления отправляется в текстовом виде с HTTP-заголовком: Signature.

ВАЖНО: со стороны API-сервера подписываются только ответы на авторизованные запросы с корректной подписью!
## Примеры кода на PHP
Пример кода на PHP формирования запроса для осуществления соединения между номерами
+7 904 111-22-33 и +7 999 111-22-33 с отображением номера +7 495 111-22-33 при вызовах:

<?php

$data = json\_encode([

`    `'callerId'  => ‘74951112233’,

`    `'dstNumber' => '79041112233',

`    `'srcNumber' => '79991112233',

`    `'timeout' => 30,

]);

var\_dump($data);

$time = time();

$resId = curl\_init();

$key = getKey('call/start\_simple\_call',

$time,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl\_setopt\_array($resId, [

`    `CURLINFO\_HEADER\_OUT => true,

`    `CURLOPT\_HEADER => 0,

`    `CURLOPT\_HTTPHEADER => [

`        `'Authorization: Bearer '.$key ,

`        `'Content-Type: application/json' ,

`    `],

`    `CURLOPT\_POST => true,

`    `CURLOPT\_RETURNTRANSFER => true,

`    `CURLOPT\_SSL\_VERIFYPEER => false,

`    `CURLOPT\_URL => 'https://api.new-tel.net/call/start\_simple\_call',

`    `CURLOPT\_POSTFIELDS => $data,

]);

$response = curl\_exec($resId);

$curlInfo = curl\_getinfo($resId);



echo $response;

function getKey ($methodName , $time , $keyNewtel  , $params , $writeKey  ) {

`    `return $keyNewtel.$time.hash( 'sha256' , $methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

}                                                                                                                                                                                                                                                                                                        

Пример кода на PHP формирования запроса для осуществления соединения между номерами
+7 904 111-22-33 и +7 999 111-22-33 с отображением номера +7 495 111-22-33 при вызовах:

#
# **Группа методов для управления компанией в контексте абонента «Нью-Тел» (company/\*)**
Получение информации о компании: текущее состояние, информация о сотрудниках, номерах телефонов, тарифах, расходах и пр.

Доступные методы:

Получение информации о состоянии компании-абонента

Получение информации из профиля компании

Получение информации о сотрудниках компании

Получение списка сотрудников компании

Получение информации из профиля сотрудника компании

Получение списков номеров телефонов компании
## **Получение информации о состоянии компании-абонента**
Метод возвращает состояние компании-абонента «Нью-Тел»: баланс, статус и пр.

ВАЖНО: это единственный метод, который возвращает данные в случае, если аккаунт компании заблокирован, например, из-за недостатка средств на счёте!
### **Наименование метода**
company/get-state
### **Параметры запроса**
нет
### **Ограничение запросов**
стандартное
### **Данные ответа**
объект state, содержащий свойства:

|balance|–|текущий баланс компании, целое или десятичное число (максимум 2 знака после запятой) или null, если информация о балансе не предоставляется|
| :- | :-: | :- |
|credit|–|кредит для компании, целое или десятичное число (максимум 2 знака после запятой) или null, если информация о кредите не предоставляется|
|currency|–|<p>валюта расчётов, строка, возможные значения:</p><p>"RUB" – российский рубль, "EUR" – евро, "USD" – доллар США</p>|
|dayTrafficCost|–|расходы за последние сутки|
|monthTrafficCost|–|расходы за последний месяц, число|
|status|–|<p>текущий статус аккаунта компании, строка, возможные значения:</p><p>"active" – активен, "blocked" – заблокирован, "testing" – тестовый период, "suspended" – обслуживание приостановлено</p>|
Это лишнее, не надо писать php код для каждого запроса, там 3/4 статической информации, надо написать пример запроса как он есть
Это лишнее, не надо писать php код для каждого запроса, там 3/4 статической информации, надо написать пример запроса как он есть

<?php

$dataArr = '';

$data = json\_encode($dataArr);

var\_dump($data);

$time = time();

$resId = curl\_init();

$key = getKey('company/get-state',

$time ,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl\_setopt\_array($resId, [

`	`CURLINFO\_HEADER\_OUT => true,

`	`CURLOPT\_HEADER => 0,

`	`CURLOPT\_HTTPHEADER => [

`    	`'Authorization: Bearer '.$key ,

`    	`'Content-Type: application/json' ,

`	`],

`	`CURLOPT\_POST => true,

`	`CURLOPT\_RETURNTRANSFER => true,

`	`CURLOPT\_SSL\_VERIFYPEER => false,

`	`CURLOPT\_URL => 'https://api.new-tel.net/company/get-state',

`	`CURLOPT\_POSTFIELDS => $data,

`	`]);

`	`$response = curl\_exec($resId);

`	`$curlInfo = curl\_getinfo($resId);

`    `var\_dump($response);                                                                                                                                                                                                                                                                                     

function getKey ($methodName , $time , $keyNewtel  , $params , $writeKey  ) {

//var\_dump($methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

return $keyNewtel.$time.hash( 'sha256' , $methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

}
### **Пример ответа**
{

`      `"status":"success",

` 	 `"data":{"result":"success",

`          `"state":{

`          	`"balance":-131,

`              `"credit":0,

`   	         `"currency":"RUB",

`              `"dayTrafficCost":0,

`              `"monthTrafficCost":33.08,

`              `"status":"active"}

`       `}

}
## **Получение информации из профиля компании**
Метод возвращает данные профиля компании: ID, наименование, сведения о регистрации и пр.
### **Наименование метода**
company/get-profile-details
### **Параметры запроса**
нет
### **Ограничение запросов**
стандартное
### **Данные ответа**
объект profileDetails, содержащий свойства:

|id|–|ID компании, целое число|
| :- | :-: | :- |
|companyName|–|наименование организации, строка|
|registeredBy|–|наименование организации, создавшей аккаунт компании, строка или null, если аккаунт был создан при самостоятельной регистрации|
|registeredOn|–|время создания аккаунта компании, Unix timestamp|
|agreementNumber|–|номер договора, строка или null, если параметры договора недоступны|
|agreementDate|–|дата договора, строка или null, если параметры договора недоступны|
### **Пример запроса на PHP**
<?php

$dataArr = '';

$data = json\_encode($dataArr);

var\_dump($data);

$time = time();

$resId = curl\_init();

$key = getKey('company/get-profile-details',

$time,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl\_setopt\_array($resId, [

`	`CURLINFO\_HEADER\_OUT => true,

`	`CURLOPT\_HEADER => 0,

`	`CURLOPT\_HTTPHEADER => [

`    	`'Authorization: Bearer '.$key ,

`    	`'Content-Type: application/json' ,

`	`],

`	`CURLOPT\_POST => true,

`	`CURLOPT\_RETURNTRANSFER => true,

`	`CURLOPT\_SSL\_VERIFYPEER => false,

`	`CURLOPT\_URL => 'https://api.new-tel.net/company/get-profile-details',

`	`CURLOPT\_POSTFIELDS => $data,

`	`]);



`	`$response = curl\_exec($resId);

`	`$curlInfo = curl\_getinfo($resId);

`	`var\_dump($response);                                                                                                                                                                                                                                                                                                                    

function getKey ($methodName , $time , $keyNewtel  , $params , $writeKey  ) {

//var\_dump($methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

return $keyNewtel.$time.hash( 'sha256' , $methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

}
### **Пример ответа**
{

`      	 `"status":"success",

`       	`"data":{

`       	`"result":"success",

`       	`"profileDetails":{

`                  	`"id":7701,

`                  	`"companyName":"Проверка системы",

`                  	`"registeredBy":"ООО «Нью-Тел»",

`                  	`"registeredOn":1607762100,

`	                  `"agreementNumber":null,

`                  	`"agreementDate":null

`        	`}

`        	`}

}




## **Получение информации о сотрудниках компании**
Метод возвращает данные профилей сотрудников компании: имя, email, номера телефонов и пр.
### **Наименование метода**
company/get-members
### **Параметры запроса**
нет
### **Ограничение запросов**
стандартное
### **Данные ответа**
массив members – массив объектов, каждый из которых содержит свойства:

|Id|–|ID сотрудника, число|
| :- | :-: | :- |
|Name|–|имя сотрудника, строка|
|Email|–|адрес электронной почты, строка|
|internalNumber|–|внутренний номер, строка или null, если внутренний номер не назначен|
|personalNumber|–|личный номер, строка или null, если личный номер не задан|
|timeZone|–|временная зона, строка|
### **Пример запроса на PHP**
<?php

$dataArr = '';

$data = json\_encode($dataArr);

var\_dump($data);

$time = time();

$resId = curl\_init();

$key = getKey('company/get-members', $time ,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl\_setopt\_array($resId, [

`    `CURLINFO\_HEADER\_OUT => true,

`    `CURLOPT\_HEADER => 0,

`    `CURLOPT\_HTTPHEADER => [

`        `'Authorization: Bearer '.$key ,

`        `'Content-Type: application/json' ,

`    `],

`    `CURLOPT\_POST => true,

`    `CURLOPT\_RETURNTRANSFER => true,

`    `CURLOPT\_SSL\_VERIFYPEER => false,

`    `CURLOPT\_URL => 'https://api.new-tel.net/company/get-members',

`    `CURLOPT\_POSTFIELDS => $data,

`    `]);



`    `$response = curl\_exec($resId);

`    `$curlInfo = curl\_getinfo($resId);

`    `var\_dump($response);                                                                                                                                                                                                                                                                                                                    

function getKey ($methodName , $time , $keyNewtel  , $params , $writeKey  ) {

//var\_dump($methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

return $keyNewtel.$time.hash( 'sha256' , $methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

}
### **Пример ответа**
{

`   	`"status":"success",

`   	`"data":{

`   	`"result":"success",

`   	`"members":[

`          	`{

`               	`"id":9423,

`                	`"name":"Сергей",

` 	            `"email":"prostoforce1995@mail.ru",

`                	`"internalNumber":"900",

`                	`"personalNumber":"79311110714",

`                	`"timeZone":"Europe/Moscow"

`          	`},

`          	`{

`                	`"id":9862,

`                	`"name":"Игорь",

`                	`"email":"shilovigor@new-tel.net",

`                	`"internalNumber":"303",

`                	`"personalNumber":null,

`                	`"timeZone":"Europe/Moscow"

`       	   `},

`          	`{

`                	`"id":10185,

`                	`"name":"evgen",

`                	`"email":"boriso1155151@gmail.com",

`                	`"internalNumber":"902",

`                	`"personalNumber":"79311110537",

`                	`"timeZone":"Europe/Moscow"

`            	`}

`            	`]

`            	`}

}




## **Получение списка сотрудников компании**
Метод возвращает список с именами всех сотрудников компании.
### **Наименование метода**
company/get-members-list
### **Параметры запроса**
нет
### **Ограничение запросов**
стандартное
### **Данные ответа**
массив membersList – список с именами сотрудников компании
### **Пример запроса на PHP**
<?php

$dataArr = '';

$data = json\_encode($dataArr);

var\_dump($data);

$time = time();

$resId = curl\_init();

$key = getKey('company/get-members-list',

$time,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl\_setopt\_array($resId, [

`	`CURLINFO\_HEADER\_OUT => true,

`	`CURLOPT\_HEADER => 0,

`	`CURLOPT\_HTTPHEADER => [

`    	`'Authorization: Bearer '.$key ,

`    	`'Content-Type: application/json' ,

`	`],

`	`CURLOPT\_POST => true,

`	`CURLOPT\_RETURNTRANSFER => true,

`	`CURLOPT\_SSL\_VERIFYPEER => false,

`	`CURLOPT\_URL => 'https://api.new-tel.net/company/get-members-list',

`	`CURLOPT\_POSTFIELDS => $data,

`	`]);



`	`$response = curl\_exec($resId);

`	`$curlInfo = curl\_getinfo($resId);



`	`echo $response;



function getKey ($methodName , $time , $keyNewtel  , $params , $writeKey  ) {

`    `//var\_dump($methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

`	`return $keyNewtel.$time.hash( 'sha256' , $methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

}
### **Пример ответа**
{

`        	`"status": "success",

`        	`"data": {

`	    	`"result": "success",

`	    	`"membersList": [

`    		`"Иванов Иван",

`    		`"Петров Андрей"

`	    	`]

`        	`}

}


## **Получение информации из профиля сотрудника компании**
Метод возвращает данные профиля сотрудника компании: имя, email, номера телефонов и пр.
### **Наименование метода**
company/get-member-details
### **Параметры запроса**

|name|–|имя сотрудника компании, строка длиной не менее 1 символа|
| :- | :-: | :- |
### **Ограничение запросов**
стандартное
### **Данные ответа**
объект memberDetails, содержащий свойства:

|Id|–|Id сотрудника, число|
| :- | :-: | :- |
|name|–|имя сотрудника, строка|
|email|–|адрес электронной почты, строка|
|internalNumber|–|внутренний номер, строка или null, если внутренний номер не назначен|
|personalNumber|–|личный номер, строка или null, если личный номер не задан|
|timeZone|–|временная зона, строка|
Если сотрудника компании с именем, указанном в параметре запроса name нет, будет сформировано сообщение об ошибке "Member not found".
### **Пример запроса на PHP**
<?php

$data = json\_encode([

`	`'name' => 'Игорь'

]);

var\_dump($data);

$time = time();

$resId = curl\_init();

$key = getKey('company/get-member-details',

$time ,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl\_setopt\_array($resId, [

`	`CURLINFO\_HEADER\_OUT => true,

`	`CURLOPT\_HEADER => 0,

`	`CURLOPT\_HTTPHEADER => [

`    	`'Authorization: Bearer '.$key ,

`    	`'Content-Type: application/json' ,

`	`],

`	`CURLOPT\_POST => true,

`	`CURLOPT\_RETURNTRANSFER => true,

`	`CURLOPT\_SSL\_VERIFYPEER => false,

`	`CURLOPT\_URL => 'https://api.new-tel.net/company/get-member-details',

`	`CURLOPT\_POSTFIELDS => $data,

`	`]);



`	`$response = curl\_exec($resId);

`	`$curlInfo = curl\_getinfo($resId);

`	`echo $response;                                                                                                                                                                                                                                                                                                                    

function getKey ($methodName , $time , $keyNewtel  , $params , $writeKey  ) {

`	`//var\_dump($methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

`	`return $keyNewtel.$time.hash( 'sha256' , $methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

}
### **Пример ответа**
{

"status":"success",

"data":{

`    	`"result":"success",

`    	`"memberDetails":{

`                       	`"id":9862,

`                       	`"name":"Игорь",

`                       	`"email":"shilovigor@new-tel.net",

`                        `"internalNumber":"303",

`                       	`"personalNumber":null,

`                       	`"timeZone":"Europe/Moscow"

`           	`}

`           	`}

}

` `**Получение списков номеров телефонов компании**

Метод возвращает списки номеров телефонов компании, сгруппированных по типу.
### **Наименование метода**
company/get-numbers
### **Параметры запроса**
нет
### **Ограничение запросов**
стандартное
### **Данные ответа**
объект numbers, содержащий массивы:

|external|–|список внешних номеров телефонов. Номера представляют собой строку.|
| :- | :-: | :- |
|internal|–|список внутренних номеров телефонов. Номера представляют собой строку.|
|virtual|–|список виртуальных номеров телефонов. Номера представляют собой строку.|
### **Пример запроса на PHP**
<?php

$dataArr = '';

$data = json\_encode($dataArr);

var\_dump($data);

$time = time();

$resId = curl\_init();

$key = getKey('company/get-numbers',

$time ,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl\_setopt\_array($resId, [

`	`CURLINFO\_HEADER\_OUT => true,

`	`CURLOPT\_HEADER => 0,

`	`CURLOPT\_HTTPHEADER => [

`    	`'Authorization: Bearer '.$key ,

`    	`'Content-Type: application/json' ,

`	`],

`	`CURLOPT\_POST => true,

`	`CURLOPT\_RETURNTRANSFER => true,

`	`CURLOPT\_SSL\_VERIFYPEER => false,

`	`CURLOPT\_URL => 'https://api.new-tel.net/company/get-numbers',

`	`CURLOPT\_POSTFIELDS => $data,

`	`]);

`	`$response = curl\_exec($resId);

`	`$curlInfo = curl\_getinfo($resId);

`    `var\_dump($response);                                                                                                                                                                                                                                                                                                                    

function getKey ($methodName , $time , $keyNewtel  , $params , $writeKey  ) {

//var\_dump($methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

return $keyNewtel.$time.hash( 'sha256' , $methodName."\n".$time."\n".$keyNewtel."\n".$params."\n".$writeKey);

}
### **Пример ответа**
{

"status":"success",

`   	`"data":{

`   	      `“result":"success",

`               	 `"numbers":{

`                          	`"external":[

`                                  	`"74951089830",

`                                  	`"74956408992",

`                                  	`"74997540086",

`                                  	`"78007776117",

`                                  	`"78122428679",

`                                  	`"79311110537",

`                                  	`"79311110714"

],

`     	`"internal":[

`                	`"100",

`                	`"101",

`                	`"111",

`                	`"303",

`                	`"900",

`                	`"902"

],

`       	`"virtual":[

`                      	`]

`      	`}

`      	`}

}


# **Группа методов для управления аккаунтом авторизованного пользователя (user/\*)**
Получение информации из профиля пользователя, смена логина, пароля, ключей для взаимодействия по API и пр.

Доступные методы:

Получение информации из профиля авторизованного пользователя


## **Получение информации из профиля авторизованного пользователя**
Метод возвращает данные профиля авторизованного пользователя-сотрудника компании: имя, email, номера телефонов.
### **Наименование метода**
user/get-profile-details
### **Параметры запроса**
нет
### **Ограничение запросов**
стандартное
### **Данные ответа**
объект profileDetails, содержащий свойства:

|name|–|имя сотрудника, строка|
| :- | :-: | :- |
|email|–|адрес электронной почты, строка|
|internalNumber|–|внутренний номер, строка или null, если внутренний номер не назначен|
|personalNumber|–|личный номер, строка или null, если личный номер не задан|
|timeZone|–|временная зона, строка|
### **Пример ответа**
{

`        	`"status": "success",

`        	`"data": {

`	    	`"result": "success",

`	    	`"profileDetails": {

`    		`"name": “Иванов Иван”,

`    		`"email": "ivanov@company.org",

`    		`"internalNumber": "100",

`    		`"personalNumber": "79991234567",

`    		`"timeZone": "Europe/Moscow"

`	    	`}

`        	`}

}


Документация по API «Нью-Тел»	PAGE33

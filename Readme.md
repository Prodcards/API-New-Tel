![](https://github.com/prodcards/API-New-Tel/blob/main/logo.svg)
# Группа методов для управления компанией в контексте абонента «Нью-Тел» (company/*)

Получение информации о компании: текущее состояние, информация о сотрудниках, номерах телефонов, тарифах, расходах/company/get-members-list и пр.

Доступные методы:

[Получение информации о состоянии компании-абонента](#1)

[Получение информации из профиля компании](#2)

[Получение информации о сотрудниках компании](#3)

[Получение списка сотрудников компании](#4)

[Получение информации из профиля сотрудника компании](#5)

[Получение списков номеров телефонов компании](#6)

<a name="1"></a>
## Получение информации о состоянии компании-абонента
Метод возвращает состояние компании-абонента «Нью-Тел»: баланс, статус и пр.
ВАЖНО: это единственный метод, который возвращает данные в случае, если аккаунт компании заблокирован, например, из-за недостатка средств на счёте!
### Наименование метода
company/get-state
### Атрибуты запроса
нет
### Пример запроса
	URI
		https://api.new-tel.net/company/get-state
	HEAD
		Authorization: Bearer df9b7fg89n79...
		Content-Type: application/json
	BODY
		{}
### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| state | Object | Да | Сведения о компании |
| balance | Integer | Да |Текущий баланс компании в указанной валюте расчётов. Может принимать отрицательное значение или null, если информация о балансе не предоставляется |
|  credit | Integer | Да | Кредит для компании в указанной валюте расчётов. Может принимать значение Null, если информация о кредите не предоставляется |
|  currency | String | Да | Валюта расчётов, возможные значения: <ul><li>"RUB" – российский рубль;</li><li>"EUR" – евро;</li><li>"USD" – доллар США</li></ul>|
|  dayTrafficCost | integer | Да | Расходы за последние сутки в указанной валюте расчетов |
|  monthTrafficCost | integer | Да | Суммарные расходы за последний месяц в указанной валюте расчетов |
|  status | String | Да | Текущий статус аккаунта компании, возможные значения:<ul><li>"active" – активен;</li><li>"blocked" – заблокирован;</li><li>"testing" – тестовый период;</li><li>"suspended" – обслуживание приостановлено.</li><ul> |
	
### Пример ответа
	STATUS: 200 OK

	BODY

	{
		"status": "success",
		"data": {
			"result": "success",
			"state": {
				"balance": -131,
				"credit": 0,
				"currency": "RUB",
				"dayTrafficCost": 0,
				"monthTrafficCost": 33.08,
				"status": "active"
			}
		}
	}
	
<a name="2"></a>
## Получение информации из профиля компании
Метод возвращает данные профиля компании: ID, наименование, сведения о регистрации и пр.
### Наименование метода
company/get-profile-details
### Атрибуты запроса
нет
### Пример запроса
	URL
		https://api.new-tel.net/company/get-profile-details
	HEAD
		Authorization: Bearer df9b7fg89n79...
		Content-Type: application/json
	BODY
		{}
### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| profileDetails | Object | Да | Сведения из профиля компании |
|Id | Integer | Да | Id компании |
|companyName | String | Да | Сокращенное наименование компании |
|registeredBy | String | Да | Наименование компании - технологического партнера, если аккаунта был создан технологическим партнером. Если аккаунт был создан при самостоятельной регистрации, то null |
|registeredOn | Timestamp | Да | Время создания аккаунта компании, Unix timestamp |
|agreementNumber | String | Да | Номер договора, строка или null, если параметры договора недоступны |
|agreementDate | String | Да | Дата договора, строка или null, если параметры договора недоступны |

### Пример ответа

	STATUS: 200 OK

	BODY

	{
		"status": "success",
		"data": {
			"result": "success",
			"profileDetails": {
				"id": 7701,
				"companyName": "Нью-Тел Проверка системы",
				"registeredBy": "ООО «Нью-Тел»",
				"registeredOn": 1607762100,
				"agreementNumber": "7701-121220/U/CP",
				"agreementDate": "2020-12-12"
			}
		}
	}
	
<a name="3"></a>
## Получение информации о сотрудниках компании
Метод возвращает данные профилей сотрудников компании: имя, email, номера телефонов и пр.
### Наименование метода
company/get-members
### Атрибуты запроса
Нет
### Пример запроса

	URL
		https://api.new-tel.net/company/get-members
	HEAD
		Authorization: Bearer df9b7fg89n79...
		Content-Type: application/json
	BODY
		{}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| members | Array_object | Да | Массив, возвращает сведения из профиля сотрудников компании |
|Id | Integer | Да | ID сотрудника |
|name | String | Да | Имя сотрудника |
|email | String | Да | Адрес электронной почты |
|internalNumber | String( | Нет | Внутренний номер телефона, строка или null, если внутренний номер не назначен |
|personalNumber | String | Нет | Личный номер телефона, строка или null, если личный номер не задан |
|timeZone | String | Нет | Временная зона |

### Пример ответа

	STATUS: 200 OK
	
	BODY
	
	{
		"status": "success",
		"data": {
			"result": "success",
			"members": [{
				"id": 9423,
				"name": "Иванов Сергей Иванович",
				"email": "prostoforce1995@mail.ru",
				"internalNumber": "900",
				"personalNumber": "79311110714",
				"timeZone": "Europe/Moscow"
			}]
		}
	}
	
<a name="4"></a>
## Получение списка сотрудников компании
Метод возвращает список с именами всех сотрудников компании.
### Наименование метода
company/get-members-list
### Атрибуты запроса
Нет
### Пример запроса

	URL
		https://api.new-tel.net/company/get-members-list
	HEAD
		Authorization: Bearer df9b7fg89n79...
		Content-Type: application/json
	BODY
		{}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| membersList | Array_string | Да | Строковой массив со списком сотрудников компании, в качестве значения передается имена сотрудников|

### Пример ответа

	STATUS: 200 OK
	
	BODY
	
	{
		"status": "success",
		"data": {
			"result": "success",
			"membersList": ["Сергей", "Игорь"]
		}
	}
	
<a name="5"></a>
## Получение информации из профиля сотрудника компании
Метод возвращает данные профиля сотрудника компании: имя, email, номера телефонов и пр.
### Наименование метода
company/get-member-details
### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| name | String | Да | Имя сотрудника, строка длиной не менее 1 символа |

### Пример запроса

	URL
		https://api.new-tel.net/company/get-member-details
	HEAD
		Authorization: Bearer df9b7fg89n79…
		Content-Type: application/json
	BODY
	{
		"name": "Игорь"
	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| mMembersDetails | Object | Да | Массив, возвращает сведения из профиля сотрудника компании |
|Id | Integer | Да | ID сотрудника |
|name | String | Да | Имя сотрудника. Полученное значение в ответе зависит от того, как сотрудники были заведены в личном кабинете "Нью-Тел". Может быть только имя, может быть имя и фамилия, может быть полное ФИО. Может быть как на кириллице, так и на латинице. |
|email | String | Да | Адрес электронной почты |
|internalNumber | String | Да | Внутренний номер телефона, строка или null, если внутренний номер не назначен |
|personalNumber | String | Да | Личный номер телефона, строка или null, если личный номер не задан |
|timeZone | String | Да | Временная зона в текстовом формате |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Member not found | Если сотрудника компании с именем, указанном в параметре запроса name нет, будет сформировано сообщение об ошибке "Member not found". |

### Пример ответа

STATUS: 200 OK

BODY

	{
		"status": "success",
		"data": {
			"result": "success",
			"memberDetails": {
				"id": 9862,
				"name": "Игорь",
				"email": "shilovigor@new-tel.net",
				"internalNumber": "303",
				"personalNumber": null,
				"timeZone": "Europe/Moscow"
			}
		}
	}
	
<a name="6"></a>
## Получение списков номеров телефонов компании
Метод возвращает списки номеров телефонов компании, сгруппированных по типу.
### Наименование метода
company/get-numbers
### Атрибуты запроса
Нет
### Пример запроса

	URL
		https://api.new-tel.net/company/get-numbers
	HEAD
		Authorization: Bearer df9b7fg89n79…
		Content-Type: application/json
	BODY
		{}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| numbers | Object | Да | Объект содержит 3 массива, external, internal и virtual |
|external | | Да | Cписок внешних номеров телефонов. |
|internal | | Да | Cписок внутренних номеров телефонов. |
|virtual | | Да | Cписок виртуальных номеров телефонов. |

### Пример ответа

	STATUS: 200 OK

	BODY

	{
		"status": "success",
		"data": {
			"result": "success",
			"numbers": {
				"external": ["74951089830", "74956408992", "74997540086", "78007776117", "78122428679", "79311110537", "79311110714"],
				"internal": ["100", "101", "111", "303", "900", "902"],
				"virtual": []
			}
		}
	}

# Группа методов для управления аккаунтом авторизованного пользователя (user/*)

Получение информации из профиля пользователя, смена логина, пароля, ключей для взаимодействия по API и пр.

Доступные методы:

[Получение информации из профиля авторизованного пользователя](#7)

##
<a name="7"></a>
## Получение информации из профиля авторизованного пользователя

Метод возвращает данные профиля авторизованного пользователя-сотрудника компании: имя, email, номера телефонов. Под авторизованным пользователем понимается тот пользователь, API ключи которого используются при генерации Bearer токена.

### Наименование метода

user/get-profile-details

### Атрибуты запроса

Нет

### Пример запроса

URL

https://api.new-tel.net/user/get-profile-details

HEAD

Authorization: Bearer df9b7fg89n79…

Content-Type: application/json

BODY

{}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| profileDetails | Array object | Да | Массив, возвращает сведения из профиля сотрудника компании |
|id | Integer | Да | ID сотрудника |
|name | String | Да | Имя сотрудника |
|email | String | Да | Адрес электронной почты |
|internalNumber | String | Да | Внутренний номер телефона, строка или null, если внутренний номер не назначен |
|personalNumber | String | Да | Личный номер телефона, строка или null, если личный номер не задан |
|timeZone | String | Да | Временная зона |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"profileDetails": {

	"id": 10185,

	"name": "evgen",

	"email": "boriso1155151@gmail.com",

	"internalNumber": "902",

	"personalNumber": "79311110537",

	"timeZone": "Europe/Moscow"

	}

	}

	}

# Группа методов для генерации вызовов (call/*)

Генерация вызовов через API, получение данных по идентификатору сгенерированного вызова.

Доступные методы:

[Инициирование простого вызова](#8)

[Инициирование вызова системы CallPassword](#9)

[Инициирование голосового вызова системы CallPassword](#10)

[Получение идентификатора вызова в виртуальной АТС](#11)

##
<a name="8"></a>
## Инициирование простого вызова

Метод осуществляет соединение между номерами и источника и назначения, отображая при вызовах имеющийся внешний номер компании.

### Наименование метода

call/start-simple-call

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callerId | String | Да | Отображаемый номер, от 4 до 15 десятичных цифр, не начиная с 0 или с "+" |
|dstNumber | String | Да | Номер телефона назначения, от 9 до 15 десятичных цифр, не начиная с 0 или с "+" |
|srcNumber | String | Да | Номер телефона источника, от 2 до 15 десятичных цифр, не начиная с 0 или с "+", можно указать несколько номеров через запятую |
|timeout | Integer | Нет | Время ожидания ответа в секундах, число от 20 до 99. В случае отсутствия время ожидания ответа будет установлено 20 секунд |

### Пример запроса

	URL
		https://api.new-tel.net/call/start-simple-call
	HEAD
		Authorization: Bearer df9b7fg89n79…
		Content-Type: application/json
	BODY
		{
		"callid": "79168457854",
		"dstNumber": "79035675124",
		"srcNumber": "303",
		"timeout": 20
		}

### Атрибуты ответа

свойство callId – идентификатор сгенерированного вызова, строка

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Destination and source numbers must not match | В запросе совпадают значения dstNumber и srcNumber, что не допустимо |
| 200 | Specified caller ID not allowed | Номер телефона, указанный в параметре запроса callerId не допускается |

### Пример ответа

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callId": "1234567890123456"

	}

	}

##
<a name="9"></a>
## Инициирование вызова системы  CallPassword

Метод осуществляет вызов на номер назначения, отображая в качестве источника номер из пула системы CallPassword для использования авторизации по звонку.

### Наименование метода

call/start-password-call

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|async | Integer | Да | Флаг асинхронности запроса, число 0 или 1 |
|dstNumber | String | Да | Номер телефона назначения, от 9 до 15 десятичных цифр, не начиная с 0 или "+" |
|pin | String | Нет | Код, который будет использован как последние 5 цифр номера источника, 5 десятичных цифр, необязательный параметр, в случае отсутствия будет сгенерирован API-сервером |
|timeout | Integer | Да | Время ожидания ответа в секундах, число от 20 до 99, необязательный параметр, в случае отсутствия время ожидания ответа будет установлено 20 секунд |

Примечание: при синхронном запросе (async=0) API-сервер сформрует ответ только после получения статуса вызова, определение которого может продолжаться не менее времени ожидания ответа, указанного в параметре timeout; при асинхронном (async=1) – ответ будет сформирован сразу после обработки запроса, при этом статус вызова будет неопределён.

### Пример запроса

	URL

		https://api.new-tel.net/call/start-simple-call

	HEAD

		Authorization: Bearer df9b7fg89n79…

		Content-Type: application/json

	BODY

		{

		"async": 0,

		"dstNumber": "79035675124",

		"pin": "41236",

		"timeout": 5

		}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| callDetails | Array object | Да | Массив, содержащий свойства |
|callId | Integer | Да | Идентификатор сгенерированного вызова |
|pin | String | Да | Пин код |
|status | String | Да | Статус дозвона. Строка или null |
|oper | String | Да | Оператор |
|region | String | Да | Регион |
|isValidNumber | String | Да | Валидность телефонного номера. Может принимать значения:
</li><li>"true" – номер валиден;
</li><li>"false" – номер не валиден
 |
|reasonCode | String | Да | Код причины |
|phoneNumber | String | Да | Номер телефона |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callDetails": {

	"callId": "2096093321622464437",

	"pin": "78514",

	"status": null,

	"oper": "ПАО Вымпел-Коммуникации",

	"region": "г. Москва и Московская область",

	"isValidNumber": true,

	"reasonCode": null,

	"phoneNumber": null

	}

	}

	}

##
<a name="10"></a>
## Инициирование голосового вызова системы CallPassword

Метод осуществляет вызов на номер назначения, отображая в качестве источника номер из пула системы CallPassword для использования авторизации по звонку. В отличие от метода start-password-call Пин код пользователю озвучивает робот при совершении телефонного вызова.

### Наименование метода

call/start-voice-password-call

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|async | Integer | Да | Флаг асинхронности запроса, число 0 или 1 |
|dstNumber | String | Да | Номер телефона назначения, от 9 до 15 десятичных цифр, не начиная с 0 или "+" |
|text | String | Нет | Текст, который будет озвучивать робот пользователю в ходе телефонного звонка. Не более 200 символов |
|timeout | Integer | Да | Время ожидания ответа в секундах, число от 20 до 99, необязательный параметр, в случае отсутствия время ожидания ответа будет установлено 20 секунд |

Примечание: при синхронном запросе (async=0) API-сервер сформрует ответ только после получения статуса вызова, определение которого может продолжаться не менее времени ожидания ответа, указанного в параметре timeout; при асинхронном (async=1) – ответ будет сформирован сразу после обработки запроса, при этом статус вызова будет неопределён.

### Пример запроса

URL

https://api.new-tel.net/call/start-voice-simple-call

HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"async": 0,

	"dstNumber": "79035675124",

	"text": "ВашПИНкод 1236",

	"timeout": 10

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| callDetails | Array object | Да | Массив, содержащий свойства |
|callId | Integer | Да | Идентификатор сгенерированного вызова |
|pin | String | Да | Пин код |
|status | String | Да | Статус дозвона. Строка или null |
|oper | String | Да | Оператор |
|region | String | Да | Регион |
|isValidNumber | String | Да | Валидность телефонного номера. Может принимать значения:
</li><li>"true" – номер валиден;
</li><li>"false" – номер не валиден
 |
|reasonCode | String | Да | Код причины или null |
|phoneNumber | String | Да | Номер телефона или null |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callDetails": {

	"callId": "2096093321622464437",

	"pin": "78514",

	"status": null,

	"oper": "ПАО Вымпел-Коммуникации",

	"region": "г. Москва и Московская область",

	"isValidNumber": true,

	"reasonCode": null,

	"phoneNumber": null

	}

	}

	}
	
<a name="11"></a>
## Получение идентификатора вызова в виртуальной АТС

Метод возвращает идентификатор вызова vbpxId для взаимодействия с вызовом в контексте виртуальной АТС.

### Наименование метода

call/get-vpbx-id

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callid | String | Да | Идентификатор вызова, строка |

### Пример запроса

	URL

	https://api.new-tel.net/call/get-vpbx-idl

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"callId": "1234567890123456"

	}

### Атрибуты ответа

свойство vpbxId – идентификатор вызова в виртуальной АТС, строка

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Call not found or unavailable | Если информации по указанному идентификатору callId нет (например, если вызываемый абонент не отвечает или данные о вызове уже удалёны из кеша виртуальной АТС), будет сформировано сообщение об ошибке "Call not found or unavailable" |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"vpbxId": "da39a3ee5e6b4b0d3255bfef95601890afd80709"

	}

	}

# Группа методов для взаимодействия с вызовами в контексте виртуальной АТС (vpbx/\*)

Получение данных и взаимодействие с вызовами по идентификатору вызова в виртуальной АТС

Доступные методы:

[Получение данных о вызовах за 24 часа](#12)

[Получение списка вызовов за 24 часа](#13)

[Получение данных об активных вызовах](#14)

[Получение списка активных вызовов](#15)

[Получение полных данных о вызове](#16)

[Получение направления вызова](#17)

[Получение статуса вызова](#18)

[Получение времени начала вызова](#19)

[Получение времени ответа на вызов](#20)

[Получение времени окончания вызова](#21)

[Получение номера А входящего вызова](#22)

[Получение номера Б входящего вызова](#23)

[Получение списка всех ответивших на входящий вызов внутренних номеров](#24)

[Получение первого ответившего на входящий вызов внутреннего номера](#25)

[Получение внутреннего номера, осуществившего исходящий вызов](#26)

[Получение номера A исходящего вызова](#27)

[Получение номера Б исходящего вызова](#28)

[Получение ссылки на звукозапись разговора](#29)

[Получение списка внутренних номеров с успешно зарегистрированными SIP-аккаунтами](#30)

[Получение списка внутренних номеров, на которыe идёт вызов](#31)

[Получение списка внутренних номеров, на которые идёт разговор](#32)

[Перехват вызова по внутреннему номеру](#33)

[Перехват вызова по внутреннему номеру (для звонка в состоянии дозвона)](#34)

[Перехват вызова по идентификатору вызова в виртуальной АТС](#35)

[Перевод вызова на внутренний номер](#36)

[Подключение к внутреннему номеру для прослушивания разговора](#37)

[Завершение активного вызова](#38)

##
<a name="12"></a>
## Получение данных о вызовах за 24 часа

Метод возвращает информацию о вызовах за 24 часа из кеша виртуальной АТС: статус, направление, номера телефонов, время.

### Наименование метода

vpbx/get-calls

### Атрибуты запроса

нет

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-calls

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| Calls | Array\_object | Да | Массив объектов, каждый из которых содержит свойства |
|vpbxId | String | Дв | Идентификатор вызова в виртуальной АТС |
|active | String | Нет | Флаг активности вызова, true или false |
|direction | String | Нет | Направление вызова, возможные значения:
</li><li>"in" – входящий вызов;
</li><li>"out" – исходящий вызов
 |
|clid | String | Да | Номер вызывающего абонента (номер А) |
|dnid | String | Да | Номер вызываемого абонента (номер Б) |
|status | String | Да | Статус вызова, возможные значения:
</li><li>"answered" – отвеченный вызов;
</li><li>"no answer" – вызов без ответа
 |
|startTime | Timestamp | Да | Время начала вызова, Unix timestamp |
|answerTime | Timestamp | Да | Время ответа на вызов, Unix timestamp или null, если вызов без ответа |
|endTime | Timestamp | Да | Время окончания вызова, Unix timestamp или null, если вызов активен |

Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"calls": [{

	"vpbxId": "e935025c738c35a3f9c2ef1f0dd90db6f921e845",

	"direction": "out",

	"startTime": 1620311786,

	"answerTime": 1620311793,

	"endTime": 1620311800,

	"status": "answered",

	"active": false,

	"clid": "303",

	"dnid": "79397085955"

	}]

	}

	}

<a name="13"></a>
## Получение списка вызовов за 24 часа

Метод возвращает список вызовов за 24 часа из кеша виртуальной АТС в виде их идентификаторов в виртуальной АТС.

### Наименование метода

vpbx/get-calls-list

### Атрибуты запроса

нет

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-calls-list

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{}

### Атрибуты ответа

массив callsList – список идентификаторов вызовов в виртуальной АТС

### Пример ответа

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callsList": [

	"da39a3ee5e6b4b0d3255bfef95601890afd80709",

	"943a702d06f34599aee1f8da8ef9f7296031d699"

	]

	}

	}

##
<a name="14"></a>
## Получение данных об активных вызовах

Метод возвращает информацию о текущих активных вызовах из кеша виртуальной АТС: статус, направление, номера телефонов, время.

### Наименование метода

vpbx/get-active-calls

### Атрибуты запроса

нет

### Пример запроса

	URL

	https://api.new-tel.net/user/get-active-calls

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| activeCalls | Array\_object | Да | Массив объектов, каждый из которых содержит свойства: |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС |
|direction | String | Да | Направление вызова, возможные значения:
</li><li>"in" – входящий вызов;
</li><li>"out" – исходящий вызов
 |
|startTime | Timestamp | Да | Время начала вызова, Unix timestamp |
|answerTime | Timestamp | Да | Время ответа на вызов, Unix timestamp или null, если вызов без ответа |
|endTime | Timestamp | Да | Время окончания вызова, Unix timestamp или null |
|status | String | Да | Статус вызова, возможные значения:
</li><li>"answered" – отвеченный вызов;
</li><li>"no answer" – вызов без ответа
 |
|active | String | Да | Флаг активности вызова, всегда true |
|clid | String | Да | Номер вызывающего (номер А) |
|dnid | String | Да | Номер вызываемого (номер Б) |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"activeCalls": [{

	"vpbxId": "6e422df412d790bc7d849ef39c330defd5297854",

	"direction": "in",

	"startTime": 1620397311,

	"answerTime": null,

	"endTime": 1620397312,

	"status": "no answer",

	"active": true,

	"clid": "79852638590",

	"dnid": "78122428679"

	}]

	}

	}

<a name="15"></a>
## Получение списка активных вызовов

Метод возвращает список текущих активных вызовов из кеша виртуальной АТС в виде их идентификаторов в виртуальной АТС.

### Наименование метода

vpbx/get-active-calls-list

### Атрибуты запроса

нет

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-active-calls-list

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| activeCallsList | Array\_string | Да | Список идентификаторов вызовов в виртуальной АТС |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"activeCallsList": ["70bf5ef3002f3075c78bd24faf2d360c6e358299"]

	}

	}

##
	
<a name="16"></a>
## Получение полных данных о вызове

Метод возвращает информацию о вызове из кеша виртуальной АТС: статус, направление, номера телефонов, время.

### Наименование метода

vpbx/get-call-details

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-call-details

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
| callDetails | Object | Да | Список идентификаторов вызовов в виртуальной АТС |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС |
|active | String | Да | Флаг активности вызова, true или false |
|direction | String | Да | Направление вызова, возможные значения:
</li><li>"in" – входящий вызов;
</li><li>"out" – исходящий вызов
 |
|clid | String | Да | Номер вызывающего (номер А) |
|dnid | String | Да | Номер вызываемого (номер Б) |
|status | String | Да | Статус вызова, возможные значения:
</li><li>"answered" – отвеченный вызов;
</li><li>"no answer" – вызов без ответа
 |
|startTime | Timestamp | Да | Время начала вызова, Unix timestamp |
|answerTime | Timestamp | Да | Время ответа на вызов, Unix timestamp или null, если вызов без ответа |
|endTime | Timestamp | Да | Время окончания вызова, Unix timestamp или null, если вызов активен |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callDetails": {

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160",

	"direction": "in",

	"startTime": 1620390705,

	"answerTime": 1620390708,

	"endTime": 1620390710,

	"status": "answered",

	"active": false,

	"clid": "79616087636",

	"dnid": "78122428679",

	"answeredNumbers": ["101"],

	"firstAnsweredNumber": "101"

	}

	}

	}

<a name="17"></a>
## Получение направления вызова

Метод возвращает направление вызова.

### Наименование метода

vpbx/get-call-direction

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-call-direction

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callDirection | String | Да | Направление вызова, возможные значения:
</li><li>"in" – входящий вызов;
</li><li>"out" – исходящий вызов
 |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callDirection": "in"

	}

	}
	
<a name="18"></a>
## Получение статуса вызова

Метод возвращает статус вызова по имеющемуся у пользователя идентификатору..

### Наименование метода

vpbx/get-call-status

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-call-status

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callStatus | String | Да | Статус вызова, возможные значения:
</li><li>"answered" – отвеченный вызов;
</li><li>"no answer" – вызов без ответа
 |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callStatus": "answered"

	}

	}

<a name="19"></a>
## Получение времени начала вызова

Метод возвращает время начала вызова.

### Наименование метода

vpbx/get-call-start-time

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-call-start-time

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callStartTime | Timestamp | Нет | Время начала вызова, Unix timestamp |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callStartTime": 1620390705

	}

	}

<a name="20"></a>
## Получение времени ответа на вызов

Метод возвращает время ответа на вызов.

### Наименование метода

vpbx/get-call-answer-time

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-call-answer-time

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callAnswerTime | Timestamp | Нет | Время ответа, Unix timestamp или null, если вызов без ответа |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callAnswerTime": 1620390708

	}

	}

##
<a name="21"></a>
## Получение времени окончания вызова

Метод возвращает время окончания вызова.

### Наименование метода

vpbx/get-call-end-time

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-call-end-time

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callEndTime | Timestamp | Нет | Время окончания вызова, Unix timestamp или null, если вызов активен. |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Данные ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callEndTime": 1620311800

	}

	}

##
<a name="22"></a>
## Получение номера вызывающего (номера А) для входящего вызова

Метод возвращает номер вызывающего (номер А) для входящего вызова.

### Наименование метода

vpbx/get-inbound-call-clid

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-inbound-call-clid

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callClid | String | Да | Номер вызывающего (номер А) входящего вызова. |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Method for inbound call only | Если по указанному идентификатору vpbxId имеются данные исходящего вызова, будет сформировано сообщение об ошибке "Method for inbound call only" |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callClid": "79616087636"

	}

	}

##
<a name="23"></a>
## Получение номера вызываемого (номер Б) входящего вызова

Метод возвращает номер вызываемого (номер Б) входящего вызова.

### Наименование метода

vpbx/get-inbound-call-dnid

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-inbound-call-dnid

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callDnid | String | Нет | Номер вызываемого (номер Б) входящего вызова. |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Method for inbound call only | Если по указанному идентификатору vpbxId имеются данные исходящего вызова, будет сформировано сообщение об ошибке "Method for inbound call only" |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callDnid": "78122428679"

	}

	}

##
<a name="24"></a>
## Получение списка всех ответивших на входящий вызов внутренних номеров

Метод возвращает список всех ответивших на входящий вызов внутренних номеров в порядке очерёдности их ответа.

### Наименование метода

vpbx/get-inbound-call-answered-numbers

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-inbound-call-answered-numbers

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callAnsweredNumbers | Array | Нет | Список всех ответивших внутренних номеров |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Method for inbound call only | Если по указанному идентификатору vpbxId имеются данные исходящего вызова, будет сформировано сообщение об ошибке "Method for inbound call only". |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callAnsweredNumbers": [

	"79616087609",

	"79616087636"

	]

	}

	}
	
<a name="25"></a>
## Получение первого ответившего на входящий вызов внутреннего номера

Метод возвращает первый ответивший на входящий вызов внутренний номер.

### Наименование метода

vpbx/get-inbound-call-first-answered-number

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-inbound-first-answered-numbers

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callFirstAnsweredNumbers | String | Нет | Первый ответивший внутренний номер |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Method for inbound call only | Если по указанному идентификатору vpbxId имеются данные исходящего вызова, будет сформировано сообщение об ошибке "Method for inbound call only". |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callFirstAnsweredNumber": "101"

	}

	}

##
<a name="26"></a>
## Получение внутреннего номера, осуществившего исходящий вызов

Метод возвращает внутренний номер, осуществивший исходящий вызов.

### Наименование метода

vpbx/get-outbound-call-internal-clid

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно вызвать методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-outbound-call-internal-clid

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callInternalClid | String | Нет | Первый ответивший внутренний номер |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Method for outbound call only | Если по указанному идентификатору vpbxId имеются данные входящего вызова, будет сформировано сообщение об ошибке "Method for outbound call only". |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Пример ответа

	STATUS: 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callInternalClid": "303"

	}

	}

##
<a name="27"></a>
## Получение номера вызывающего (номера A) исходящего вызова

Метод возвращает номер вызывающего (номер А) исходящего вызова.

### Наименование метода

vpbx/get-outbound-call-external-clid

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-outbound-call-external-clid

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callExternalClid | String | Нет | Номер вызывающего (номер А) исходящего вызова |

### Возможные коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 200 | Method for outbound call only | Если по указанному идентификатору vpbxId имеются данные входящего вызова, будет сформировано сообщение об ошибке "Method for outbound call only". |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

### Пример ответа

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callExternalClid": "303"

	}

	}
	
<a name="28"></a>
## Получение номера Б исходящего вызова

Метод возвращает номер вызываемого (номер Б) исходящего вызова.

### Наименование метода

vpbx/get-outbound-call-dnid

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-outbound-call-dnid

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callDnid | String | Да | Номер вызываемого (номер Б) исходящего вызова |

### Возможные коды ошибок

| 200 | Method for outbound call only | Если по указанному идентификатору vpbxId имеются данные входящего вызова, будет сформировано сообщение об ошибке "Method for outbound call only" |
| --- | --- | --- |
| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callDnid": "79397085955"

	}

	}

###


##
<a name="29"></a>
## Получение ссылки на звукозапись разговора

Метод возвращает ссылку на звукозапись разговора.

### Наименование метода

vpbx/get-call-record-link

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-call-record-link

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|callRecordLink | String | Нет | Ссылка на звукозапись разговора в формате mp3. Авторизация для прослушивания файла не нужна |

### Возможные коды ошибок

| 200 | Call not found | Если информации по указанному идентификатору vpbxId нет, будет сформировано сообщение об ошибке "Call not found" |
| --- | --- | --- |

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"callRecordLink": "https://web.new-tel.net/public/audio/rec21162031178605100770106004541338"

	}

	}

##
<a name="30"></a>
## Получение списка внутренних номеров с успешно зарегистрированными SIP-аккаунтами

Метод возвращает список внутренних номеров, на которых успешно зарегистрированы соответствующие SIP-аккаунты.

### Наименование метода

vpbx/get-registered-numbers-list

### Атрибуты запроса

нет

### Пример запроса

	URL

	[https://api.new-tel.net/vpbx/get-registered](https://api.new-tel.net/vpbx/get-registered)-numbers-list

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{}

### Атрибуты ответа

массив registeredNumbersList – список внутренних номеров, на которых успешно зарегистрированы соответствующие SIP-аккаунты

### Пример ответа

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"registeredNumbersList": [

	"100",

	"200"

	]

	}

	}
	
<a name="31"></a>
## Получение списка внутренних номеров ,  на которые идёт вызов

Метод возвращает список внутренних номеров, на которые идёт вызов.

### Наименование метода

vpbx/get-ringing-numbers-list

### Атрибуты запроса

Нет

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-ringin-numbers-list

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{}

	### Атрибуты ответа

	массив ringingNumbersList – список внутренних номеров, на которые идёт вызов

	### Пример ответа

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"ringingNumbersList": [

	"100",

	"200"

	]

	}

	}

<a name="32"></a>
## Получение списка внутренних номеров, на которых идёт разговор

Метод возвращает список внутренних номеров, на которые идёт разговор.

### Наименование метода

vpbx/get-active-numbers-list

### Атрибуты запроса

Нет

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/get-active-numbers-list

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{}

### Атрибуты ответа

массив activeNumbersList – список внутренних номеров, на которых идёт разговор

### Пример ответа

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success",

	"activeNumbersList": [

	"100",

	"200"

	]

	}

	}

##
<a name="33"></a>
## Перехват вызова по внутреннему номеру

Метод позволяет перехватить звонок по идентификатору вызова

### Наименование метода

vpbx/get-pickup-call-by-number

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |
|toNumber | String | Да | Внутренний номер, который ответит на звонок. 2-4 цифры, целые |
|ringingNumber | String | Да | Внутренний номер, на который идет звонок. 2-4 цифры, целые |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/transfer-call

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxid": "402ec8f63d1c6eb2b59948c67181bc196a52f160",

	"toNumber": 303

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|result | String | Да | Объект result – может принимать одно из 2-х значений:
</li><li>"success" - подключение произошло;
</li><li>"error" - подключения не произошло
 |

### Пример ответа

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success"

	}

	}

<a name="34"></a>
## Перехват вызова по внутреннему номеру (для звонка в состоянии дозвона)

Метод позволяет перехватить любой вызов по идентификатору вызова для звонка в состоянии дозвона

### Наименование метода

vpbx/pickup-call

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |
|toNumber | String | Да | Внутренний номер, который ответит на звонок. 2-4 цифры, целые |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/pickup-call

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxId": "402ec8f63d1c6eb2b59948c67181bc196a52f160",

	"toNumber": 303

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|result | String | Да | Объект result – может принимать одно из 2-х значений:
</li><li>"success" - подключение произошло;
</li><li>"error" - подключения не произошло
 |

### Пример ответа

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success"

	}

	}
	
<a name="35"></a>
## Перевод вызова на внутренний номер

Метод позволяет перевести любой звонок на внутренний номер

### Наименование метода

vpbx/transfer-call

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |
|toNumber | String | Да | Внутренний номер, который ответит на звонок. 2-4 цифры, целые |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/transfer-call

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxid": "402ec8f63d1c6eb2b59948c67181bc196a52f160",

	"toNumber": 303

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|result | String | Да | Объект result – может принимать одно из 2-х значений:
</li><li>"success" - подключение произошло;
</li><li>"error" - подключения не произошло
 |

### Пример ответа

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success"

	}

	}
	
<a name="36"></a>
## Подключение к внутреннему номеру для прослушивания разговора

Метод. позволяет прослушать разговор путем подключения к внутреннему номеру.

### Наименование метода

vpbx/listen-call

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |
|toNumber | String | Да | Внутренний номер, который ответит на звонок. 2-4 цифры, целые |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/listen-call

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxid": "402ec8f63d1c6eb2b59948c67181bc196a52f160",

	"toNumber": 303

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|result | String | Да | Объект result – может принимать одно из 2-х значений:
</li><li>"success" - подключение произошло;
</li><li>"error" - подключения не произошло
 |

### Пример ответа

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success"

	}

	}

<a name="37"></a>
## Завершение активного вызова

Метод позволяет принудительно завершить звонок по идентификатору вызова.

### Наименование метода

vpbx/get/hangup-call

### Атрибуты запроса

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|vpbxId | String | Да | Идентификатор вызова в виртуальной АТС, 40 шестнадцатеричных цифр в нижнем регистре, который можно получить методами:
- call/get-vpbx-id;
- vpbx/get-calls-list;
- vpbx/get-active-calls-list;
- vpbx/get-call-details
 |

### Пример запроса

	URL

	https://api.new-tel.net/vpbx/hangup-call

	HEAD

	Authorization: Bearer df9b7fg89n79…

	Content-Type: application/json

	BODY

	{

	"vpbxid": "402ec8f63d1c6eb2b59948c67181bc196a52f160"

	}

### Атрибуты ответа

| Атрибут | Тип данных | Обяз. | Примечание |
| --- | --- | --- | --- |
|result | String | Да | Объект result – может принимать одно из 2-х значений:
</li><li>"success" - подключение произошло;
</li><li>"error" - подключения не произошло
 |

### Пример ответа

	STATUS 200 OK

	BODY

	{

	"status": "success",

	"data": {

	"result": "success"

	}

	}

#


# Коды ошибок

| HTTP-статус | Текст ошибки | Примечание |
| --- | --- | --- |
| 405 | Method Not Allowed | Неверный метод запроса (например, GET).<br><br>Также дополнительно будет заголовок ответа: `Allow: POST` и сообщение в свойстве ответа`"message": "GET not allowed"` (указывается именно текущий метод запроса). |
| 406 | Not Acceptable | Неверный заголовок `Accept` |
| 415 | Unsupported Media Type | Отсутствует заголовок `Content-Type`<br><br>Сообщение в свойстве ответа `"message": "Content-Type not set"` |
| 415 | Unsupported Media Type | Неверный заголовок `Content-Type`<br><br>Сообщение в свойстве ответа `"message": "Content-Type xxx not supported"` (указывается именно текущее значение заголовка). |
| 400 | Bad Request | Неверные данные для авторизации (при отсутствии заголовка `Authorization` или неверном формате данных в заголовке).<br><br>Также дополнительно будет заголовок ответа:`WWW-Authenticate: Bearer error="invalid\_request"`и сообщение в свойстве ответа `"message": "Invalid authorization data"`. |
| 401 | Unauthorized | Авторизация не удалась (неверный или неактуальный/устаревший ключ). <br><br>Также дополнительно будет заголовок ответа: `WWW-Authenticate: Bearer error="invalid\_token"` и сообщение в свойстве ответа `"message": "Authorization failed"`. |
| 400 | Bad Request | Неверная подпись запроса (вычислена неверно). <br><br>Cообщение в свойстве ответа `"message":"Invalid request signature"` |
| 402 | Bad Request | Метка времени находится за пределами допустимого диапазона. <br><br>Cообщение в свойстве ответа `"message":"Invalid request timestamp"` |
| 403 | 403 Forbidden | Доступ запрещён (на данный момент только, когда аккаунт компании заблокирован). <br><br>Также дополнительно будет заголовок ответа. `WWW-Authenticate: Bearer error="insufficient_scope"` и сообщение в свойстве ответа `"message": "Access denied"` |
| 404 | Not Found | Метод не существует. <br><br>Сообщение в свойстве ответа `"message": "Requested method not found"` |
| 423 | Bad Request | Неверный формат данных запроса (при значении заголовка `Content-Type` как `application/json`). <br><br>Сообщение в свойстве ответа `"message": "Invalid JSON data"` |
| 422 | Unprocessable entity | Неверные или отсутствующие параметры запроса. <br><br>Отсутствуют несколько обязательных параметров. Cообщение в свойстве ответа `"message": "Required parameters missing: paramName1, paramName2, paramName3"` |
| 422 | Unprocessable entity | Неверные или отсутствующие параметры запроса. <br><br>Отсутствует один обязательный параметр. Cообщение в свойстве ответа `"message": "Required parameter missing: paramName"` |
| 422 | Unprocessable entity | Неверные или отсутствующие параметры запроса. <br><br>Неверный формат или данные в нескольких параметрах (только если присутствуют все обязательные параметры). Cообщение в свойстве ответа `"message": "Invalid parameters: paramName1, paramName2"`|
| 422 | Unprocessable entity | Неверные или отсутствующие параметры запроса. Неверный формат или данные параметра (только если присутствуют все обязательные параметры).<br><br>Cообщение в свойстве ответа `"message": "Invalid parameter: paramName"` |

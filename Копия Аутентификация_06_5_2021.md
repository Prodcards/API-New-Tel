Документация по API «Нью-Тел»

Версия этого документа: непубличный документ (БЕТА-версия от 03.05.21).

Данный документ описывает возможности взаимодействия с API «Нью-Тел», доступные
всем зарегистрированным абонентам, у которых подключена услуга «Интеграция +
API/Webhooks».

Для взаимодействия с API «Нью-Тел» необходимо в личном кабинете системы в
разделе «\_______» сформировать два постоянных ключа: «Ключ доступа к
API-серверу» и «Ключ для подписи запросов», которые будут использоваться для
авторизации запросов, приходящих из информационной системе клиента.
Рекомендуется для каждой системы клиента, которая будет интегрироваться с
системой «Нью-Тел», сформировать собственные ключи, чтобы в случае их
компрометации - злоумышленники могли перехватить данные только одной из систем,
а не всех сразу.

# Описание протокола

1.  Запросы к API «Нью-Тел» осуществляются посредством протокола HTTPS на адрес:
    https://api.new-tel.net/.

2.  Для шифрования трафика должен использоваться криптографический протокол SSL
    версии \__\_ и выше. Запросы с протоколом TLS любой версии и SSL версии ниже
    требуемой - будут отклонены системой с ошибкой \___\_.

3.  Для всех запросов используется только метод POST, следуя спецификации
    HTTP/1.1.

4.  Параметры запроса передаются в теле сообщения в формате:

application/json или application/x-www-form-urlencoded.

1.  Строка параметров запроса должна быть сформирована в кодировке UTF-8 без
    дополнительных пробелов и переносов строк. Например, в PHP это можно сделать
    методами: json_encode(\$params) или http_build_query(\$params),

    где: \$params – ассоциативный массив параметров или объект.

2.  Формат данных запроса должен быть указан в заголовке: Content-Type.

3.  Корректная длина сообщения должна быть указана в заголовке: Content-Length.

4.  Ответные данные возвращаются всегда в кодировке UTF-8. Формат данных может
    быть указан в заголовке Accept, где допускаются следующие значения:

    application/json – для ответа в формате JSON;

    application/xml – для ответа в формате XML;

    В случае отсутствия в запросе заголовка Accept данные возвращаются в формате
    JSON.

Примечание: в данной документации все примеры ответов API-сервера
отформатированы с добавлением пробелов и переводов строк для лучшей читаемости.

## Аутентификация и авторизация

Для авторизации запросов используется схема на основе Bearer токена, при этом
интеграция не подразумевает полноценную реализацию протокола oAuth 2.0 с выдачей
access и refresh токенов. Достаточно в каждый запрос добавить Bearer токен в
формате:

Authorization: Bearer token

Токен формируется для каждого запроса динамически и представляет собой строку
длиной 112 символа, полученной путем конкатенации:

1.  Постоянного «Ключа доступа к API-серверу».

2.  Метки времени.

3.  Подписи запроса в виде хэша по алгоритму SHA-256 от нескольких переменных
    путем их конкатенации.

См. пример формирования токена на PHP:

\$token = \$keyNewtel.\$time.hash ("sha256",
\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey)

где:

1.  \\n - команда переноса строки, является разделителем переменных.

2.  \$methodName - относительный путь для вызова метода, например:
    company/get-state.

3.  \$time - метка времени запроса, формируется динамически клиентом при
    создании запроса и передаётся в виде Unix timestamp. Представляет собой
    строку, состоящую из 10-и десятичных цифр. **Для прохождения аутентификации
    и авторизации все запросы должны иметь метку времени в пределах ±10 минут от
    текущего мирового времени.**

4.  \$keyNewtel - постоянный «Ключ доступа к API-серверу», который представляет
    собой строку из 48-и шестнадцатеричных цифр в нижнем регистре (десятичных
    цифр и латинских букв «a», «b», «c», «d», «e» и «f»). Ключ доступа имеет
    неограниченный срок жизни и формируется клиентом самостоятельно в личном
    кабинете «Нью-Тел».

5.  \$params - тело запроса (BODY) со всеми значениями в application/json или
    application/x-www-form-urlencoded формате.

6.  \$writeKey - постоянный «Ключ для подписи запросов», который представляет
    собой строку из 48-и шестнадцатеричных цифр в нижнем регистре (десятичных
    цифр и латинских букв «a», «b», «c», «d», «e» и «f»). Ключ доступа имеет
    неограниченный срок жизни и формируется клиентом самостоятельно в личном
    кабинете «Нью-Тел».

Пример успешного запроса к серверу приведен ниже.

\<?php

\$dataArr = '';

\$data = json_encode(\$dataArr);

var_dump(\$data);

\$time = time();

\$resId = curl\_init();

\$token = getToken('company/get-state',

\$time,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

\$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl_setopt\_array(\$resId, [

CURLINFO_HEADER_OUT =\> true,

CURLOPT_HEADER =\> 0,

CURLOPT_HTTPHEADER =\> [

'Authorization: Bearer '.\$key ,

'Content-Type: application/json' ,

],

CURLOPT_POST =\> true,

CURLOPT_RETURNTRANSFER =\> true,

CURLOPT_SSL_VERIFYPEER =\> false,

CURLOPT_URL =\> 'https://api.new-tel.net/company/get-state',

CURLOPT_POSTFIELDS =\> \$data,

]);

\$response = curl_exec(\$resId);

\$curlInfo = curl_getinfo(\$resId);

var_dump(\$response);

function getToken (\$methodName , \$time , \$keyNewtel , \$params , \$writeKey )

{

return \$keyNewtel.\$time.hash( 'sha256' ,

\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

}

## Параметры ответа

При формировании ответа API-сервер устанавливает соответствующие HTTP-статусы и
заголовки. В теле ответа возвращается объект, обязательно содержащий свойство
status, отображающее результат обработки запроса API-сервером, строка с одним из
значений:

"success" – обработка запроса прошла успешно (аутентификация и авторизация
произведены, запрашиваемый метод существует, все необходимые параметры
присутствуют и валидны);

"error" – при обработке запроса произошла ошибка.

Если при обработке запроса произошла ошибка, объект в теле ответа будет также
содержать свойство message, в котором будет находиться текстовое описание
ошибки. При этом будет установлен соответствующий HTTP-статус. Например, при
корректном запросе, отправленном на адрес несуществующего метода, будет
установлен HTTP-статус “404 Not Found” и сформирован ответ:

{

"status": "error",

"message": "Requested method not found"

}

При успешной обработке запроса будет установлен HTTP-статус “200 OK” и объект в
теле ответа будет содержать объект data, обязательно содержащий свойство result,
отображающее результат работы запрашиваемого метода, строка с одним из значений:

"success" – запрашиваемый метод успешно выполнен;

"error" – при выполнении метода возникла ошибка.

Если запрашиваемый метод подразумевает возврат данных, то при успешном
выполнении метода объект data будет также содержать указанное в описании метода
свойство, массив или объект, где будут находиться ответные данные.

Например, при корректном запросе, отправленном на адрес:
'https://api.new-tel.net/company/get-state формируется ответ:

{

"status":"success",

"data":{

"result":"success",

"state":{"balance":97.93,

"credit":0,

"currency":"RUB",

"dayTrafficCost":0,

"monthTrafficCost":0,

"status":"active"

}

}

}

Если при выполнении метода возникла ошибка, объект data будет также содержать
свойство message, в котором будет находиться текстовое описание ошибки.
Возможные ситуации возникновения ошибки и соответствующие сообщения перечислены
в описании методов.

Пример ответа, при котором возникла ошибка при выполнении метода:

{

"status": "success",

"data": {

"result": "error",

"message": "Error occured"

}

}

## Подпись ответа

Клиентская сторона может проверять достоверность получаемых данных, сверяя
подпись ответа. Подпись ответа вычисляется по алгоритму, аналогичному для
вычисления подписи запроса, где вместо строки параметров запроса используется
текстовый контент ответного HTTP-сообщения. Результат вычисления отправляется в
текстовом виде с HTTP-заголовком: Signature.

ВАЖНО: со стороны API-сервера подписываются только ответы на авторизованные
запросы с корректной подписью!

## Пример кода на PHP

Пример кода на PHP формирования запроса для осуществления соединения между
номерами  
\+7 904 111-22-33 и +7 999 111-22-33 с отображением номера +7 495 111-22-33 при
вызовах:

\<?php

\$data = json\_encode([

'callerId' =\> ‘74951112233’,

'dstNumber' =\> '79041112233',

'srcNumber' =\> '79991112233',

'timeout' =\> 30,

]);

var_dump(\$data);

\$time = time();

\$resId = curl\_init();

\$key = getKey('call/start_simple_call',

\$time,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

\$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl_setopt\_array(\$resId, [

CURLINFO_HEADER_OUT =\> true,

CURLOPT_HEADER =\> 0,

CURLOPT_HTTPHEADER =\> [

'Authorization: Bearer '.\$key ,

'Content-Type: application/json' ,

],

CURLOPT_POST =\> true,

CURLOPT_RETURNTRANSFER =\> true,

CURLOPT_SSL_VERIFYPEER =\> false,

CURLOPT_URL =\> 'https://api.new-tel.net/call/start_simple_call',

CURLOPT_POSTFIELDS =\> \$data,

]);

\$response = curl_exec(\$resId);

\$curlInfo = curl_getinfo(\$resId);

echo \$response;

function getKey (\$methodName , \$time , \$keyNewtel , \$params , \$writeKey ) {

//var_dump(\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

return \$keyNewtel.\$time.hash( 'sha256' ,
\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

}

## Дополнительные требования

1.  Клиентская сторона должна проверять корректность SSL-сертификата сервера, и,
    если SSL-сертификат не прошёл проверку, следует немедленно прекратить сессию
    во избежание утечки данных.

2.  Ключи для взаимодействия с API не должны храниться в открытом виде,
    например, в cookie.

История изменений документа

03.05.21 – переписан раздел «Аутентификации и авторизация»

#   


# **Группа методов для управления компанией в контексте абонента «Нью-Тел» (company/\*)**

Получение информации о компании: текущее состояние, информация о сотрудниках,
номерах телефонов, тарифах, расходах и пр.

Доступные методы:

Получение информации о состоянии компании-абонента

Получение информации из профиля компании

Получение информации о сотрудниках компании

Получение списка сотрудников компании

Получение информации из профиля сотрудника компании

Получение списков номеров телефонов компании

## **Получение информации о состоянии компании-абонента**

Метод возвращает состояние компании-абонента «Нью-Тел»: баланс, статус и пр.

ВАЖНО: это единственный метод, который возвращает данные в случае, если аккаунт
компании заблокирован, например, из-за недостатка средств на счёте!

### **Наименование метода**

company/get-state

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

объект state, содержащий свойства:

| balance          | – | текущий баланс компании, целое или десятичное число (максимум 2 знака после запятой) или null, если информация о балансе не предоставляется                                        |
|------------------|---|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| credit           | – | кредит для компании, целое или десятичное число (максимум 2 знака после запятой) или null, если информация о кредите не предоставляется                                            |
| currency         | – | валюта расчётов, строка, возможные значения: "RUB" – российский рубль, "EUR" – евро, "USD" – доллар США                                                                            |
| dayTrafficCost   | – | расходы за последние сутки                                                                                                                                                         |
| monthTrafficCost | – | расходы за последний месяц, число                                                                                                                                                  |
| status           | – | текущий статус аккаунта компании, строка, возможные значения: "active" – активен, "blocked" – заблокирован, "testing" – тестовый период, "suspended" – обслуживание приостановлено |

### **Пример запроса на PHP**

\<?php

\$dataArr = '';

\$data = json_encode(\$dataArr);

var_dump(\$data);

\$time = time();

\$resId = curl\_init();

\$key = getKey('company/get-state',

\$time ,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

\$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl_setopt\_array(\$resId, [

CURLINFO_HEADER_OUT =\> true,

CURLOPT_HEADER =\> 0,

CURLOPT_HTTPHEADER =\> [

'Authorization: Bearer '.\$key ,

'Content-Type: application/json' ,

],

CURLOPT_POST =\> true,

CURLOPT_RETURNTRANSFER =\> true,

CURLOPT_SSL_VERIFYPEER =\> false,

CURLOPT_URL =\> 'https://api.new-tel.net/company/get-state',

CURLOPT_POSTFIELDS =\> \$data,

]);

\$response = curl_exec(\$resId);

\$curlInfo = curl_getinfo(\$resId);

var_dump(\$response);

function getKey (\$methodName , \$time , \$keyNewtel , \$params , \$writeKey ) {

//var_dump(\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

return \$keyNewtel.\$time.hash( 'sha256' ,
\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

}

### **Пример ответа**

{

"status":"success",

"data":{"result":"success",

"state":{

"balance":-131,

"credit":0,

"currency":"RUB",

"dayTrafficCost":0,

"monthTrafficCost":33.08,

"status":"active"}

}

}

## **Получение информации из профиля компании**

Метод возвращает данные профиля компании: ID, наименование, сведения о
регистрации и пр.

### **Наименование метода**

company/get-profile-details

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

объект profileDetails, содержащий свойства:

| id              | – | ID компании, целое число                                                                                                       |
|-----------------|---|--------------------------------------------------------------------------------------------------------------------------------|
| companyName     | – | наименование организации, строка                                                                                               |
| registeredBy    | – | наименование организации, создавшей аккаунт компании, строка или null, если аккаунт был создан при самостоятельной регистрации |
| registeredOn    | – | время создания аккаунта компании, Unix timestamp                                                                               |
| agreementNumber | – | номер договора, строка или null, если параметры договора недоступны                                                            |
| agreementDate   | – | дата договора, строка или null, если параметры договора недоступны                                                             |

### **Пример запроса на PHP**

\<?php

\$dataArr = '';

\$data = json_encode(\$dataArr);

var_dump(\$data);

\$time = time();

\$resId = curl\_init();

\$key = getKey('company/get-profile-details',

\$time,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

\$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl_setopt\_array(\$resId, [

CURLINFO_HEADER_OUT =\> true,

CURLOPT_HEADER =\> 0,

CURLOPT_HTTPHEADER =\> [

'Authorization: Bearer '.\$key ,

'Content-Type: application/json' ,

],

CURLOPT_POST =\> true,

CURLOPT_RETURNTRANSFER =\> true,

CURLOPT_SSL_VERIFYPEER =\> false,

CURLOPT_URL =\> 'https://api.new-tel.net/company/get-profile-details',

CURLOPT_POSTFIELDS =\> \$data,

]);

\$response = curl_exec(\$resId);

\$curlInfo = curl_getinfo(\$resId);

sleep(1);

var_dump(\$response);

function getKey (\$methodName , \$time , \$keyNewtel , \$params , \$writeKey ) {

//var_dump(\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

return \$keyNewtel.\$time.hash( 'sha256' ,
\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

}

### **Пример ответа**

{

"status":"success",

"data":{

"result":"success",

"profileDetails":{

"id":7701,

"companyName":"Проверка системы",

"registeredBy":"ООО «Нью-Тел»",

"registeredOn":1607762100,

"agreementNumber":null,

"agreementDate":null

}

}

}

## **Получение информации о сотрудниках компании**

Метод возвращает данные профилей сотрудников компании: имя, email, номера
телефонов и пр.

### **Наименование метода**

company/get-members

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

массив members – массив объектов, каждый из которых содержит свойства:

| Id             | – | ID сотрудника, число                                                 |
|----------------|---|----------------------------------------------------------------------|
| Name           | – | имя сотрудника, строка                                               |
| Email          | – | адрес электронной почты, строка                                      |
| internalNumber | – | внутренний номер, строка или null, если внутренний номер не назначен |
| personalNumber | – | личный номер, строка или null, если личный номер не задан            |
| timeZone       | – | временная зона, строка                                               |

### **Пример запроса на PHP**

\<?php

\$dataArr = '';

\$data = json_encode(\$dataArr);

var_dump(\$data);

\$time = time();

\$resId = curl\_init();

\$key = getKey('company/get-members', \$time
,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',\$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl_setopt\_array(\$resId, [

CURLINFO_HEADER_OUT =\> true,

CURLOPT_HEADER =\> 0,

CURLOPT_HTTPHEADER =\> [

'Authorization: Bearer '.\$key ,

'Content-Type: application/json' ,

],

CURLOPT_POST =\> true,

CURLOPT_RETURNTRANSFER =\> true,

CURLOPT_SSL_VERIFYPEER =\> false,

CURLOPT_URL =\> 'https://api.new-tel.net/company/get-members',

CURLOPT_POSTFIELDS =\> \$data,

]);

\$response = curl_exec(\$resId);

\$curlInfo = curl_getinfo(\$resId);

var_dump(\$response);

function getKey (\$methodName , \$time , \$keyNewtel , \$params , \$writeKey ) {

//var_dump(\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

return \$keyNewtel.\$time.hash( 'sha256' ,
\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

}

### **Пример ответа**

{

"status":"success",

"data":{

"result":"success",

"members":[

{

"id":9423,

"name":"Сергей",

"email":"prostoforce1995@mail.ru",

"internalNumber":"900",

"personalNumber":"79311110714",

"timeZone":"Europe/Moscow"

},

{

"id":9862,

"name":"Игорь",

"email":"shilovigor@new-tel.net",

"internalNumber":"303",

"personalNumber":null,

"timeZone":"Europe/Moscow"

},

{

"id":10185,

"name":"evgen",

"email":"boriso1155151@gmail.com",

"internalNumber":"902",

"personalNumber":"79311110537",

"timeZone":"Europe/Moscow"

}

]

}

}

## **Получение списка сотрудников компании**

Метод возвращает список с именами всех сотрудников компании.

### **Наименование метода**

company/get-members-list

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

массив membersList – список с именами сотрудников компании

### **Пример запроса на PHP**

\<?php

\$dataArr = '';

\$data = json_encode(\$dataArr);

var_dump(\$data);

\$time = time();

\$resId = curl\_init();

\$key = getKey('company/get-members-list',

\$time,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

\$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl_setopt\_array(\$resId, [

CURLINFO_HEADER_OUT =\> true,

CURLOPT_HEADER =\> 0,

CURLOPT_HTTPHEADER =\> [

'Authorization: Bearer '.\$key ,

'Content-Type: application/json' ,

],

CURLOPT_POST =\> true,

CURLOPT_RETURNTRANSFER =\> true,

CURLOPT_SSL_VERIFYPEER =\> false,

CURLOPT_URL =\> 'https://api.new-tel.net/company/get-members-list',

CURLOPT_POSTFIELDS =\> \$data,

]);

\$response = curl_exec(\$resId);

\$curlInfo = curl_getinfo(\$resId);

echo \$response;

function getKey (\$methodName , \$time , \$keyNewtel , \$params , \$writeKey ) {

//var_dump(\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

return \$keyNewtel.\$time.hash( 'sha256' ,
\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

}

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"membersList": [

"Иванов Иван",

"Петров Андрей"

]

}

}

## **Получение информации из профиля сотрудника компании**

Метод возвращает данные профиля сотрудника компании: имя, email, номера
телефонов и пр.

### **Наименование метода**

company/get-member-details

### **Параметры запроса**

| name | – | имя сотрудника компании, строка длиной не менее 1 символа |
|------|---|-----------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

объект memberDetails, содержащий свойства:

| Id             | – | Id сотрудника, число                                                 |
|----------------|---|----------------------------------------------------------------------|
| name           | – | имя сотрудника, строка                                               |
| email          | – | адрес электронной почты, строка                                      |
| internalNumber | – | внутренний номер, строка или null, если внутренний номер не назначен |
| personalNumber | – | личный номер, строка или null, если личный номер не задан            |
| timeZone       | – | временная зона, строка                                               |

Если сотрудника компании с именем, указанном в параметре запроса name нет, будет
сформировано сообщение об ошибке "Member not found".

### **Пример запроса на PHP**

\<?php

\$data = json\_encode([

'name' =\> 'Игорь'

]);

var_dump(\$data);

\$time = time();

\$resId = curl\_init();

\$key = getKey('company/get-member-details',

\$time ,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

\$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl_setopt\_array(\$resId, [

CURLINFO_HEADER_OUT =\> true,

CURLOPT_HEADER =\> 0,

CURLOPT_HTTPHEADER =\> [

'Authorization: Bearer '.\$key ,

'Content-Type: application/json' ,

],

CURLOPT_POST =\> true,

CURLOPT_RETURNTRANSFER =\> true,

CURLOPT_SSL_VERIFYPEER =\> false,

CURLOPT_URL =\> 'https://api.new-tel.net/company/get-member-details',

CURLOPT_POSTFIELDS =\> \$data,

]);

\$response = curl_exec(\$resId);

\$curlInfo = curl_getinfo(\$resId);

echo \$response;

function getKey (\$methodName , \$time , \$keyNewtel , \$params , \$writeKey ) {

//var_dump(\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

return \$keyNewtel.\$time.hash( 'sha256' ,
\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

}

### **Пример ответа**

{

"status":"success",

"data":{

"result":"success",

"memberDetails":{

"id":9862,

"name":"Игорь",

"email":"shilovigor@new-tel.net",

"internalNumber":"303",

"personalNumber":null,

"timeZone":"Europe/Moscow"

}

}

}

## **Получение списков номеров телефонов компании**

Метод возвращает списки номеров телефонов компании, сгруппированных по типу.

### **Наименование метода**

company/get-numbers

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

объект numbers, содержащий массивы:

| external | – | список внешних номеров телефонов. Номера представляют собой строку.     |
|----------|---|-------------------------------------------------------------------------|
| internal | – | список внутренних номеров телефонов. Номера представляют собой строку.  |
| virtual  | – | список виртуальных номеров телефонов. Номера представляют собой строку. |

### **Пример запроса на PHP**

\<?php

\$dataArr = '';

\$data = json_encode(\$dataArr);

var_dump(\$data);

\$time = time();

\$resId = curl\_init();

\$key = getKey('company/get-numbers',

\$time ,'616a2cbbc392c798c06161dae2bd0c2093af4f399e95f48d',

\$data,'84c29e3807ccb092f50ea7e66537ba9b519628efdd741046');

curl_setopt\_array(\$resId, [

CURLINFO_HEADER_OUT =\> true,

CURLOPT_HEADER =\> 0,

CURLOPT_HTTPHEADER =\> [

'Authorization: Bearer '.\$key ,

'Content-Type: application/json' ,

],

CURLOPT_POST =\> true,

CURLOPT_RETURNTRANSFER =\> true,

CURLOPT_SSL_VERIFYPEER =\> false,

CURLOPT_URL =\> 'https://api.new-tel.net/company/get-numbers',

CURLOPT_POSTFIELDS =\> \$data,

]);

\$response = curl_exec(\$resId);

\$curlInfo = curl_getinfo(\$resId);

var_dump(\$response);

function getKey (\$methodName , \$time , \$keyNewtel , \$params , \$writeKey ) {

//var_dump(\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

return \$keyNewtel.\$time.hash( 'sha256' ,
\$methodName."\\n".\$time."\\n".\$keyNewtel."\\n".\$params."\\n".\$writeKey);

}

### **Пример ответа**

{

"status":"success",

"data":{

“result":"success",

"numbers":{

"external":[

"74951089830",

"74956408992",

"74997540086",

"78007776117",

"78122428679",

"79311110537",

"79311110714"

],

"internal":[

"100",

"101",

"111",

"303",

"900",

"902"

],

"virtual":[

]

}

}

}

# **  
**

# **Группа методов для управления аккаунтом авторизованного пользователя (user/\*)**

Получение информации из профиля пользователя, смена логина, пароля, ключей для
взаимодействия по API и пр.

Доступные методы:

Получение информации из профиля авторизованного пользователя

## **Получение информации из профиля авторизованного пользователя**

Метод возвращает данные профиля авторизованного пользователя-сотрудника
компании: имя, email, номера телефонов.

### **Наименование метода**

user/get-profile-details

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

объект profileDetails, содержащий свойства:

| name           | – | имя сотрудника, строка                                               |
|----------------|---|----------------------------------------------------------------------|
| email          | – | адрес электронной почты, строка                                      |
| internalNumber | – | внутренний номер, строка или null, если внутренний номер не назначен |
| personalNumber | – | личный номер, строка или null, если личный номер не задан            |
| timeZone       | – | временная зона, строка                                               |

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"profileDetails": {

"name": “Иванов Иван”,

"email": "ivanov@company.org",

"internalNumber": "100",

"personalNumber": "79991234567",

"timeZone": "Europe/Moscow"

}

}

}

# **Группа методов для генерации вызовов (call/\*)**

Генерация вызовов через API, получение данных по идентификатору сгенерированного
вызова.

Доступные методы:

Инициирование простого вызова

Инициирование вызова системы CallPassword

Получение идентификатора вызова в виртуальной АТС

## **Инициирование простого вызова**

Метод осуществляет соединение между номерами источника и назначения, отображая
при вызовах имеющийся внешний номер компании.

### **Наименование метода**

call/start-simple-call

### **Параметры запроса**

| callerId  | – | отображаемый номер, строка, от 4 до 15 десятичных цифр, не начиная с 0                                                                              |
|-----------|---|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| dstNumber | – | номер телефона назначения, строка, от 9 до 15 десятичных цифр, не начиная с 0                                                                       |
| srcNumber | – | номер телефона источника, строка, от 2 до 15 десятичных цифр, не начиная с 0, можно указать несколько номеров через запятую                         |
| timeout   | – | время ожидания ответа в секундах, число от 20 до 99, необязательный параметр, в случае отсутствия время ожидания ответа будет установлено 20 секунд |

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callId – идентификатор сгенерированного вызова, строка

При совпадении значений параметров запроса dstNumber и srcNumber будет
сформировано сообщение об ошибке "Destination and source numbers must not
match".

Если номер телефона, указанный в параметре запроса callerId не допускается,
будет сформировано сообщение об ошибке "Specified caller ID not allowed".

### **Пример данных ответа**

{

"status": "success",

"data": {

"result": "success",

"callId": "1234567890123456"

}

}

## **Инициирование вызова системы CallPassword**

Метод осуществляет вызов на номер назначения, отображая в качестве источника
номер из пула системы CallPassword для использования авторизации по звонку.

### **Наименование метода**

call/start-password-call

### **Параметры запроса**

| async     | – | флаг асинхронности запроса, число 0 или 1                                                                                                                                     |
|-----------|---|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| dstNumber | – | номер телефона назначения, строка, от 9 до 15 десятичных цифр, не начиная с 0                                                                                                 |
| pin       | – | код, который будет использован как последние 5 цифр номера источника, строка, 5 десятичных цифр, необязательный параметр, в случае отсутствия будет сгенерирован API-сервером |
| timeout   | – | время ожидания ответа в секундах, число от 20 до 99, необязательный параметр, в случае отсутствия время ожидания ответа будет установлено 20 секунд                           |

Примечание: при синхронном запросе (async=0) API-сервер сформирует ответ только
после получения статуса вызова, определение которого может продолжаться не менее
времени ожидания ответа, указанного в параметре timeout; при асинхронном
(async=1) – ответ будет сформирован сразу после обработки запроса, при этом
статус вызова будет неопределён.

### **Ограничение запросов**

стандартное

### **Данные ответа**

объект callDetails, содержащий свойства:

| callId | – | идентификатор сгенерированного вызова, строка                                                                                                                                                                                                  |
|--------|---|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| pin    | – | код, который использован как последние 5 цифр номера источника, строка                                                                                                                                                                         |
| status | – | статус вызова, строка, возможные значения при синхронном запросе: "answered" – отвечено, "busy" – занято, "no answer" – нет ответа, "no such number" – номер не существует, "not available" – сеть недоступна или null при асинхронном запросе |

### **Пример данных ответа**

{

"status": "success",

"data": {

"result": "success",

"callDetails": {

"callId": "1234567890123456",

"pin": "12345"

"status": "answered"

}

}

}

## **Получение идентификатора вызова в виртуальной АТС**

Метод возвращает идентификатор вызова vbpxId для взаимодействия с вызовом в
контексте виртуальной АТС.

### **Наименование метода**

call/get-vpbx-id

### **Параметры запроса**

| callId | – | идентификатор вызова, полученный при инициировании вызова методами API, строка, 16 десятичных цифр |
|--------|---|----------------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство vpbxId – идентификатор вызова в виртуальной АТС, строка

Если информации по указанному идентификатору callId нет (например, если
вызываемый абонент не отвечает или данные о вызове уже удалёны из кеша
виртуальной АТС), будет сформировано сообщение об ошибке "Call not found or
unavailable".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"vpbxId": "da39a3ee5e6b4b0d3255bfef95601890afd80709"

}

}

#  

# **Группа методов для взаимодействия с вызовами в контексте виртуальной АТС (vpbx/\*)**

Получение данных и взаимодействие с вызовами по идентификатору вызова в
виртуальной АТС

Доступные методы:

Получение данных о вызовах за 24 часа

Получение списка вызовов за 24 часа

Получение данных об активных вызовах за 24 часа

Получение списка активных вызовов за 24 часа

Получение полных данных о вызове

Получение направления вызова

Получение статуса вызова

Получение времени начала вызова

Получение времени ответа на вызов

Получение времени окончания вызова

Получение номера А входящего вызова

Получение номера Б входящего вызова

Получение списка всех ответивших на входящий вызов внутренних номеров

Получение первого ответившего на входящий вызов внутреннего номера

Получение внутреннего номера, осуществившего исходящий вызов

Получение номера A исходящего вызова

Получение номера Б исходящего вызова

Получение ссылки на звукозапись разговора

Получение списка внутренних номеров с успешно зарегистрированными SIP-аккаунтами

Получение списка внутренних номеров, на которые идёт вызов

Получение списка внутренних номеров, на которых идёт разговор

Перехват вызова по внутреннему номеру

Перехват вызова по идентификатору вызова в виртуальной АТС

Перевод вызова на внутренний номер

Подключение к внутреннему номеру для прослушивания разговора

Завершение активного вызова

## **Получение данных о вызовах за 24 часа**

Метод возвращает информацию о вызовах за 24 часа из кеша виртуальной АТС:
статус, направление, номера телефонов, время.

### **Наименование метода**

vpbx/get-calls

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

массив calls – массив объектов, каждый из которых содержит свойства:

| vpbxId     | – | идентификатор вызова в виртуальной АТС, строка                                                           |
|------------|---|----------------------------------------------------------------------------------------------------------|
| active     | – | флаг активности вызова, true или false                                                                   |
| direction  | – | направление вызова, строка, возможные значения: "in" – входящий вызов, "out" – исходящий вызов           |
| clid       | – | номер А, строка                                                                                          |
| dnid       | – | номер Б, строка                                                                                          |
| status     | – | статус вызова, строка, возможные значения: "answered" – отвеченный вызов, "no answer" – вызов без ответа |
| startTime  | – | время начала вызова, Unix timestamp                                                                      |
| answerTime | – | время ответа на вызов, Unix timestamp или null, если вызов без ответа                                    |
| endTime    | – | время окончания вызова, Unix timestamp или null, если вызов активен                                      |

###  

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"calls": [

{

"vpbxId": "da39a3ee5e6b4b0d3255bfef95601890afd80709",

"active": false,

"direction": "in",

"clid": "79991234567",

"dnid": "78881234567"

"status": "no answer",

"startTime": 1530446400,

"answerTime": null,

"endTime": 1530446460

},

{

"vpbxId": "943a702d06f34599aee1f8da8ef9f7296031d699",

"active": true,

"direction": "out",

"clid": "78881234567",

"dnid": "79991234567"

"status": "answered",

"startTime": 1530446520,

"answerTime": 1530446530,

"endTime": null

}

]

}

}

## **Получение списка вызовов за 24 часа**

Метод возвращает список вызовов за 24 часа из кеша виртуальной АТС в виде их
идентификаторов в виртуальной АТС.

### **Наименование метода**

vpbx/get-calls-list

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

массив callsList – список идентификаторов вызовов в виртуальной АТС

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callsList": [

"da39a3ee5e6b4b0d3255bfef95601890afd80709",

"943a702d06f34599aee1f8da8ef9f7296031d699"

]

}

}

## **Получение данных об активных вызовах за 24 часа**

Метод возвращает информацию об активных вызовах за 24 часа из кеша виртуальной
АТС: статус, направление, номера телефонов, время.

### **Наименование метода**

vpbx/get-active-calls

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

массив activeCalls – массив объектов, каждый из которых содержит свойства:

| vpbxId     | – | идентификатор вызова в виртуальной АТС, строка                                                           |
|------------|---|----------------------------------------------------------------------------------------------------------|
| active     | – | флаг активности вызова, всегда true                                                                      |
| direction  | – | направление вызова, строка, возможные значения: "in" – входящий вызов, "out" – исходящий вызов           |
| clid       | – | номер А, строка                                                                                          |
| dnid       | – | номер Б, строка                                                                                          |
| status     | – | статус вызова, строка, возможные значения: "answered" – отвеченный вызов, "no answer" – вызов без ответа |
| startTime  | – | время начала вызова, Unix timestamp                                                                      |
| answerTime | – | время ответа на вызов, Unix timestamp или null, если вызов без ответа                                    |
| endTime    | – | время окончания вызова, всегда null                                                                      |

###  

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"activeCalls": [

{

"vpbxId": "943a702d06f34599aee1f8da8ef9f7296031d699",

"active": true,

"direction": "out",

"clid": "78881234567",

"dnid": "79991234567"

"status": "answered",

"startTime": 1530446520,

"answerTime": 1530446530,

"endTime": null

}

]

}

}

## **Получение списка активных вызовов за 24 часа**

Метод возвращает список активных вызовов за 24 часа из кеша виртуальной АТС в
виде их идентификаторов в виртуальной АТС.

### **Наименование метода**

vpbx/get-active-calls-list

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

массив activeCallsList – список идентификаторов вызовов в виртуальной АТС

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"activeCallsList": [

"943a702d06f34599aee1f8da8ef9f7296031d699"

]

}

}

## **Получение полных данных о вызове**

Метод возвращает информацию о вызове из кеша виртуальной АТС: статус,
направление, номера телефонов, время.

### **Наименование метода**

vpbx/get-call-details

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

объект callDetails, содержащий свойства:

| vpbxId     | – | идентификатор вызова в виртуальной АТС, строка                                                           |
|------------|---|----------------------------------------------------------------------------------------------------------|
| active     | – | флаг активности вызова, true или false                                                                   |
| direction  | – | направление вызова, строка, возможные значения: "in" – входящий вызов, "out" – исходящий вызов           |
| clid       | – | номер А, строка                                                                                          |
| dnid       | – | номер Б, строка                                                                                          |
| status     | – | статус вызова, строка, возможные значения: "answered" – отвеченный вызов, "no answer" – вызов без ответа |
| startTime  | – | время начала вызова, Unix timestamp                                                                      |
| answerTime | – | время ответа на вызов, Unix timestamp или null, если вызов без ответа                                    |
| endTime    | – | время окончания вызова, Unix timestamp или null, если вызов активен                                      |

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

###  

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callDetails": {

"vpbxId": "da39a3ee5e6b4b0d3255bfef95601890afd80709",

"active": false,

"direction": "in",

"clid": "79991234567",

"dnid": "78881234567"

"status": "no answer",

"startTime": 1530446400,

"answerTime": null,

"endTime": 1530446460

}

}

}

## **Получение направления вызова**

Метод возвращает направление вызова.

### **Наименование метода**

vpbx/get-call-direction

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callDirection – направление вызова, строка, возможные значения:

"in" – входящий вызов, "out" – исходящий вызов

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callDirection": "in"

}

}

## **Получение статуса вызова**

Метод возвращает статус вызова.

### **Наименование метода**

vpbx/get-call-status

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callStatus – статус вызова, строка, возможные значения:

"answered" – отвеченный вызов, "no answer" – вызов без ответа

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callStatus": "answered"

}

}

## **Получение времени начала вызова**

Метод возвращает время начала вызова.

### **Наименование метода**

vpbx/get-call-start-time

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callStartTime – время начала вызова, Unix timestamp

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callStartTime": 1530446400

}

}

## **Получение времени ответа на вызов**

Метод возвращает время ответа на вызов.

### **Наименование метода**

vpbx/get-call-answer-time

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callAnswerTime – время ответа, Unix timestamp или null, если вызов без
ответа

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callAnswerTime": 1530446460

}

}

## **Получение времени окончания вызова**

Метод возвращает время окончания вызова.

### **Наименование метода**

vpbx/get-call-end-time

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callEndTime – время окончания вызова, Unix timestamp или null, если
вызов активен

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callEndTime": 1530446520

}

}

## **Получение номера А входящего вызова**

Метод возвращает номер А входящего вызова.

### **Наименование метода**

vpbx/get-inbound-call-clid

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callClid – номер А входящего вызова, строка

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

Если по указанному идентификатору vpbxId имеются данные исходящего вызова, будет
сформировано сообщение об ошибке "Method for inbound call only".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callClid": "79991234567"

}

}

## **Получение номера Б входящего вызова**

Метод возвращает номер Б входящего вызова.

### **Наименование метода**

vpbx/get-inbound-call-dnid

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callDnid – номер Б входящего вызова, строка

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

Если по указанному идентификатору vpbxId имеются данные исходящего вызова, будет
сформировано сообщение об ошибке "Method for inbound call only".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callDnid": "78881234567"

}

}

## **Получение списка всех ответивших на входящий вызов внутренних номеров**

Метод возвращает список всех ответивших на входящий вызов внутренних номеров в
порядке очерёдности их ответа.

### **Наименование метода**

vpbx/get-inbound-call-answered-numbers

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

массив callAnsweredNumbers – список всех ответивших внутренних номеров

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

Если по указанному идентификатору vpbxId имеются данные исходящего вызова, будет
сформировано сообщение об ошибке "Method for inbound call only".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callAnsweredNumbers": [

"200",

"100"

]

}

}

## **Получение первого ответившего на входящий вызов внутреннего номера**

Метод возвращает первый ответивший на входящий вызов внутренний номер.

### **Наименование метода**

vpbx/get-inbound-call-first-answered-number

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callFirstAnsweredNumber – первый ответивший внутренний номер, строка

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

Если по указанному идентификатору vpbxId имеются данные исходящего вызова, будет
сформировано сообщение об ошибке "Method for inbound call only".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callFirstAnsweredNumber": "200"

}

}

## **Получение внутреннего номера, осуществившего исходящий вызов**

Метод возвращает внутренний номер, осуществивший исходящий вызов.

### **Наименование метода**

vpbx/get-outbound-call-internal-clid

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callInternalClid – внутренний номер, осуществивший исходящий вызов,
строка

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

Если по указанному идентификатору vpbxId имеются данные входящего вызова, будет
сформировано сообщение об ошибке "Method for outbound call only".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callInternalClid": "100"

}

}

## **Получение номера A исходящего вызова**

Метод возвращает номер А исходящего вызова.

### **Наименование метода**

vpbx/get-outbound-call-external-clid

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callExternalClid – номер А исходящего вызова, строка

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

Если по указанному идентификатору vpbxId имеются данные входящего вызова, будет
сформировано сообщение об ошибке "Method for outbound call only".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callExternalClid": "78881234567"

}

}

## **Получение номера Б исходящего вызова**

Метод возвращает номер Б исходящего вызова.

### **Наименование метода**

vpbx/get-outbound-call-dnid

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callDnid – номер Б исходящего вызова, строка

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

Если по указанному идентификатору vpbxId имеются данные входящего вызова, будет
сформировано сообщение об ошибке "Method for outbound call only".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callDnid": "79991234567"

}

}

## **Получение ссылки на звукозапись разговора**

Метод возвращает ссылку на звукозапись разговора.

### **Наименование метода**

vpbx/get-call-record-link

### **Параметры запроса**

| vpbxId | – | идентификатор вызова в виртуальной АТС, строка, 40 шестнадцатеричных цифр в нижнем регистре |
|--------|---|---------------------------------------------------------------------------------------------|

### **Ограничение запросов**

стандартное

### **Данные ответа**

свойство callRecordLink – ссылка на звукозапись разговора, строка

Если информации по указанному идентификатору vpbxId нет, будет сформировано
сообщение об ошибке "Call not found".

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"callRecordLink": "https://web.new-tel.net/public/audio/rec123456789…"

}

}

## **Получение списка внутренних номеров с успешно зарегистрированными SIP-аккаунтами**

Метод возвращает список внутренних номеров, на которых успешно зарегистрированы
соответствующие SIP-аккаунты.

### **Наименование метода**

vpbx/get-registered-numbers-list

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

массив registeredNumbersList – список внутренних номеров, на которых успешно
зарегистрированы соответствующие SIP-аккаунты

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"registeredNumbersList": [

"100",

"200"

]

}

}

## **Получение списка внутренних номеров, на которые идёт вызов**

Метод возвращает список внутренних номеров, на которые идёт вызов.

### **Наименование метода**

vpbx/get-ringing-numbers-list

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

массив ringingNumbersList – список внутренних номеров, на которые идёт вызов

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"ringingNumbersList": [

"100",

"200"

]

}

}

## **Получение списка внутренних номеров, на которых идёт разговор**

Метод возвращает список внутренних номеров, на которые идёт вызов.

### **Наименование метода**

vpbx/get-active-numbers-list

### **Параметры запроса**

нет

### **Ограничение запросов**

стандартное

### **Данные ответа**

массив activeNumbersList – список внутренних номеров, на которых идёт разговор

### **Пример ответа**

{

"status": "success",

"data": {

"result": "success",

"activeNumbersList": [

"100",

"200"

]

}

}
